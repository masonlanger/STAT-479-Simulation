<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mason Langer">
<meta name="author" content="Hazim Izani">
<meta name="author" content="Rohan Ahuja">

<title>2019-2020 UEFA Champions League Simulation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Report_files/libs/clipboard/clipboard.min.js"></script>
<script src="Report_files/libs/quarto-html/quarto.js"></script>
<script src="Report_files/libs/quarto-html/popper.min.js"></script>
<script src="Report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Report_files/libs/quarto-html/anchor.min.js"></script>
<link href="Report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Report_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Report_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="Report_files/libs/core-js-2.5.3/shim.min.js"></script>
<script src="Report_files/libs/react-18.2.0/react.min.js"></script>
<script src="Report_files/libs/react-18.2.0/react-dom.min.js"></script>
<script src="Report_files/libs/reactwidget-2.0.0/react-tools.js"></script>
<link href="Report_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="Report_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="Report_files/libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="Report_files/libs/reactable-binding-0.4.4/reactable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2019-2020 UEFA Champions League Simulation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Mason Langer </p>
             <p>Hazim Izani </p>
             <p>Rohan Ahuja </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary">Executive Summary</h2>
<p>Like many sports competitions and organizations around the globe in early 2020, UEFA, the governing body of soccer in Europe, decided to postpone the knockout stages of the historic and immensely popular Champions League (UCL) tournament due to the COVID-19 pandemic. When the tournament finally resumed, it did so in a modified format: UEFA elected to change the typical competition format from a two game, home-and-away series in the quarterfinal and semifinal rounds, to a single elimination format. Further, games only took place at a neutral site for both teams, with all of the remaining games being played in Porto, Portugal. After all of the changes and with the pandemic still affecting society at large, the German powerhouse of Bayern Munich won the 2019-2020 Champions League tournament, besting a Paris Saint-Germain (Paris S-G or PSG) team with superstars like Angel Di Maria, Neymar, and Kylian Mbappe 1-0<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>Therefore, this iteration of the Champions League presents an interesting challenge in itself: do the results of the 2019-20 Champions League align with the expectations of the tournament, should it have been played in its traditional two-leg format? Thus, throughout our project, we sought to simulate the tournament from the quarterfinals through the final with its typical format and analyze the results to see who won and what differed from the actual tournament’s match-ups and winners.</p>
<p>Our models used the ideas of domestic strength and home-field advantage to inform team strengths for participants in the UCL. Domestic strength was defined as a team’s performance relative to their domestic components, while home-field advantage was the associated “boost” to a UCL team in the group stages of the tournament when they played on their home pitch,</p>
<p>Instead of beginning our project at the quarterfinal stage, we wanted to simulate a round that wasn’t impacted by the COVID-19 pandemic. Thus, we started our project with simulating the round of 16, where we simulated the goals scored for each team, which we could then use to determine a winner and a probability that a given team advanced. These initial results saw strong deviations from the actual results, with teams like Juventus being predicted to have a 99% chance of advancing, while they lost to Lyon in real life.</p>
<p>After this initial case study, we pivoted to simulating only the quarterfinals through the final round. In these simulations, which were based on three different underlying models, we saw some comparable and some divergent results. Primarily, between the three models, we saw PSG favored to win the tournament, instead of the actual winners, Bayern Munich. However, our models suggested different final and semifinal match-ups, with one suggesting Spanish-side FC Barcelona would play PSG in the final, while another accurately projected the semifinal and final match-up confidently. With that said, from our results, we can draw that in an alternative path where UEFA did not modify the Champions League format, PSG, the actual runner-ups in the 2019-20 tournament, would’ve been the favorites.</p>
</section>
<section id="data-overview" class="level2">
<h2 class="anchored" data-anchor-id="data-overview">Data Overview</h2>
<p>The following data was gathered using the <code>worldfootballR</code> library to scrape 2019-20 UEFA Champions League group stage and knockout game results and the 2018-19 domestic league results for the 32 competing teams across 16 individual league competitions<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> from <a href="https://www.fbref.com">fbref.com</a>.</p>
</section>
<section id="data-pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-pre-processing">Data Pre-processing</h2>
<p>In order to use the domestic competition and UEFA Champions League matchup data scraped from <a href="https://www.fbref.com/">fbref.com</a><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> with the Bradley-Terry package, <code>BradleyTerry2</code>, the raw data must first be cleaned, parsed, and reformated into the package’s expected format. This code follows that found in Lecture 12, particularly when refactoring home and away win data into a trainable DataFrame.</p>
<p>With the leagues all concatenated together, we can check to see the distribution of the complete DataFrame’s members.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 18
   Competition_Name  Gender Country Season_End_Year Round    Wk Day   Date      
   &lt;chr&gt;             &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;date&gt;    
 1 Süper Lig         M      TUR                2019 &lt;NA&gt;     28 Sun   2019-04-14
 2 La Liga           M      ESP                2019 &lt;NA&gt;     22 Sun   2019-02-03
 3 Ligue 1           M      FRA                2019 Ligu…    35 Fri   2019-05-03
 4 La Liga           M      ESP                2019 &lt;NA&gt;      1 Sat   2018-08-18
 5 Serbian SuperLiga M      SRB                2019 Regu…    13 Sun   2018-10-28
 6 Eredivisie        M      NED                2019 Ered…     6 Sat   2018-09-22
 7 La Liga           M      ESP                2019 &lt;NA&gt;     36 Sat   2019-05-04
 8 Primeira Liga     M      POR                2019 &lt;NA&gt;     28 Sun   2019-04-07
 9 Serie A           M      ITA                2019 &lt;NA&gt;     27 Sun   2019-03-10
10 Ukrainian Premie… M      UKR                2019 Regu…    16 Sun   2018-11-25
# ℹ 10 more variables: Time &lt;time&gt;, Home &lt;chr&gt;, HomeGoals &lt;dbl&gt;, Away &lt;chr&gt;,
#   AwayGoals &lt;dbl&gt;, Attendance &lt;dbl&gt;, Venue &lt;chr&gt;, Referee &lt;chr&gt;, Notes &lt;chr&gt;,
#   MatchURL &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   home.team     away.team      home.win away.win
   &lt;fct&gt;         &lt;fct&gt;             &lt;dbl&gt;    &lt;dbl&gt;
 1 Leverkusen    Bayern Munich         1        0
 2 PSV Eindhoven Vitesse               1        0
 3 Real Sociedad Villarreal            0        1
 4 Partizan      Mladost Lučani        1        0
 5 Nice          Dijon                 0        1
 6 Austria Wien  RB Salzburg           0        2
 7 Benfica       Feirense              1        0
 8 Real Madrid   Valladolid            1        0
 9 Girona        Betis                 0        1
10 Ural          Anzhi                 0        1</code></pre>
</div>
</div>
<p>With the data now in place and formatted for <code>BradleyTerry2</code>, we can begin fitting a Bradley-Terry model to determine latent team strength for all clubs competing in the 2019-20 UEFA Champions League group stage based on their domestic league results.</p>
</section>
<section id="fitting-bradley-terry-model-based-on-domestic-league-results" class="level2">
<h2 class="anchored" data-anchor-id="fitting-bradley-terry-model-based-on-domestic-league-results">Fitting Bradley-Terry Model Based on Domestic League Results</h2>
<p>For this problem, we’ll use a weak baseline as a reference, which we found to best fit the team strengths without many missing values, due to disconnected graphs.</p>
<p>Throughout our trials, we found that the Russian team Yenisey, which placed 16th out of 16 teams in the Russian Premier League throughout the 2018-19 season, resulted in a well-defined range of team strengths.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  BradleyTerry2<span class="sc">::</span><span class="fu">BTm</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">cbind</span>(home.win, away.win),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">player1 =</span> home.team, <span class="at">player2 =</span> away.team,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">refcat =</span> <span class="st">"Yenisey"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> results)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="do">## BradleyTerry2::BTm(outcome = cbind(home.win, away.win), player1 = home.team, </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     player2 = away.team, refcat = "Yenisey", data = results)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients: (15 not defined because of singularities)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="do">##                        Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Admira             -1.699e+00  7.224e-01  -2.351 0.018703 *  </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="do">## ..ADO Den Haag        4.839e-01  5.791e-01   0.836 0.403390    </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ..AEK Athens          1.817e+00  7.762e-01   2.341 0.019250 *  </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Ajax                2.547e+00  7.054e-01   3.610 0.000306 ***</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Akhisarspor        -1.146e+00  6.298e-01  -1.820 0.068752 .  </span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Akhmat Grozny       1.802e+00  7.497e-01   2.404 0.016207 *  </span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Alanyaspor         -3.666e-01  5.764e-01  -0.636 0.524825    </span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Alavés              3.696e-01  5.777e-01   0.640 0.522352    </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Almere City        -3.180e+01  2.058e+03  -0.015 0.987674    </span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Amiens             -5.772e-03  6.290e-01  -0.009 0.992678    </span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Anderlecht          7.644e-01  6.148e-01   1.243 0.213741    </span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Angers              6.001e-01  6.662e-01   0.901 0.367694    </span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Ankaragücü         -4.069e-01  5.677e-01  -0.717 0.473604    </span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Antalyaspor        -1.961e-01  5.593e-01  -0.351 0.725882    </span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Antwerp             9.371e-01  6.072e-01   1.543 0.122744    </span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Anzhi               2.166e-01  7.402e-01   0.293 0.769815    </span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Apollon Smyrnis    -1.927e+00  9.077e-01  -2.123 0.033748 *  </span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Aris                1.009e+00  7.079e-01   1.425 0.154217    </span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Arsenal             6.169e-01  5.923e-01   1.041 0.297644    </span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Arsenal Tula        2.234e+00  7.713e-01   2.896 0.003779 ** </span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Arsenal-Kyiv       -1.628e+00  6.876e-01  -2.368 0.017877 *  </span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Asteras Tripoli     2.133e-01  7.551e-01   0.283 0.777549    </span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Atalanta            1.094e+00  5.904e-01   1.853 0.063941 .  </span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Athletic Club       4.668e-01  5.969e-01   0.782 0.434186    </span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Atlético Madrid     1.678e+00  6.414e-01   2.616 0.008887 ** </span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Atromitos           1.573e+00  7.679e-01   2.048 0.040541 *  </span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Augsburg           -1.408e+00  6.414e-01  -2.196 0.028115 *  </span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Austria Wien       -5.992e-01  6.383e-01  -0.939 0.347870    </span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Aves                8.123e-02  6.295e-01   0.129 0.897329    </span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="do">## ..AZ Alkmaar          1.017e+00  6.115e-01   1.664 0.096204 .  </span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="do">## ..B-SAD               7.097e-01  7.094e-01   1.000 0.317148    </span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Bačka Palanka       7.686e-03  6.557e-01   0.012 0.990647    </span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Baník Ostrava      -1.863e+00  6.710e-01  -2.777 0.005491 ** </span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Barcelona           2.540e+00  7.526e-01   3.375 0.000737 ***</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Başakşehir          1.379e+00  6.636e-01   2.077 0.037769 *  </span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Bayern Munich       1.662e+00  7.153e-01   2.324 0.020151 *  </span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="do">## ..BB Erzurumspor     -7.605e-01  5.951e-01  -1.278 0.201287    </span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Benfica             3.135e+00  8.328e-01   3.764 0.000167 ***</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Beşiktaş            1.034e+00  6.102e-01   1.694 0.090174 .  </span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Betis               2.706e-01  5.619e-01   0.481 0.630171    </span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Boavista            4.813e-01  6.218e-01   0.774 0.438959    </span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Bohemians 1905     -2.328e+00  7.152e-01  -3.255 0.001135 ** </span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Bologna             1.783e-01  5.852e-01   0.305 0.760551    </span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Bordeaux            2.598e-01  6.040e-01   0.430 0.667115    </span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Bournemouth        -5.983e-01  5.750e-01  -1.040 0.298114    </span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Braga               1.645e+00  6.671e-01   2.466 0.013653 *  </span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Brighton           -1.099e+00  6.044e-01  -1.818 0.069020 .  </span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Burnley            -8.262e-01  5.711e-01  -1.447 0.147999    </span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Bursaspor          -5.712e-01  6.452e-01  -0.885 0.375963    </span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Caen               -2.405e-01  6.469e-01  -0.372 0.710076    </span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Cagliari           -1.599e-01  5.935e-01  -0.269 0.787623    </span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Cambuur            -1.623e+01  1.455e+03  -0.011 0.991102    </span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Cardiff City       -1.031e+00  5.650e-01  -1.825 0.068006 .  </span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Celta Vigo         -1.046e-01  5.796e-01  -0.180 0.856818    </span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Cercle Brugge      -3.600e-01  6.496e-01  -0.554 0.579465    </span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Charleroi           5.076e-01  6.239e-01   0.814 0.415893    </span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Chaves             -1.871e-01  6.598e-01  -0.284 0.776742    </span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Chelsea             8.638e-01  6.234e-01   1.386 0.165819    </span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Chievo             -2.051e+00  8.536e-01  -2.402 0.016291 *  </span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Chornomorets       -1.424e+00  6.933e-01  -2.054 0.039947 *  </span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Club Brugge         1.787e+00  6.442e-01   2.774 0.005543 ** </span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Crystal Palace     -4.104e-01  5.642e-01  -0.727 0.466995    </span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="do">## ..CSKA Moscow         2.487e+00  7.702e-01   3.228 0.001245 ** </span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Čukarički           2.848e+00  7.959e-01   3.579 0.000345 ***</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="do">## ..De Graafschap      -6.650e-01  5.848e-01  -1.137 0.255446    </span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Den Bosch          -1.596e+01  2.521e+03  -0.006 0.994949    </span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Desna Chernihiv    -9.015e-01  6.595e-01  -1.367 0.171593    </span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Dijon              -1.869e-01  6.163e-01  -0.303 0.761682    </span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Dinamo Vranje       1.960e-01  6.189e-01   0.317 0.751492    </span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Dinamo Zagreb       3.354e+00  9.317e-01   3.600 0.000318 ***</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Dortmund            1.619e+00  7.220e-01   2.243 0.024899 *  </span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Dukla Prague       -3.591e+00  7.525e-01  -4.773 1.82e-06 ***</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Düsseldorf         -7.342e-01  6.001e-01  -1.224 0.221140    </span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Dynamo Kyiv         1.793e+00  8.030e-01   2.233 0.025534 *  </span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Dynamo Mosc         9.740e-01  8.014e-01   1.215 0.224183    </span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Eibar               1.154e-01  6.006e-01   0.192 0.847566    </span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Eint Frankfurt     -1.305e-01  6.352e-01  -0.206 0.837174    </span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Emmen              -3.381e-02  5.741e-01  -0.059 0.953035    </span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Empoli             -1.485e-01  5.758e-01  -0.258 0.796474    </span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Espanyol            5.711e-01  5.869e-01   0.973 0.330535    </span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Eupen              -6.135e-02  6.129e-01  -0.100 0.920271    </span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Everton            -1.564e-01  5.783e-01  -0.270 0.786784    </span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Excel Mouscron      3.676e-01  6.609e-01   0.556 0.578050    </span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Excelsior          -3.933e-01  5.796e-01  -0.678 0.497481    </span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Fastav Zlín        -2.122e+00  6.774e-01  -3.133 0.001728 ** </span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="do">## ..FC Kolos Kovalivka  1.414e+01  1.455e+03   0.010 0.992247    </span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="do">## ..FC Lviv            -5.977e-01  7.091e-01  -0.843 0.399287    </span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a><span class="do">## ..FC Mariupol         8.588e-02  6.333e-01   0.136 0.892132    </span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="do">## ..FC Oleksandriya     3.359e-01  6.602e-01   0.509 0.610917    </span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Feirense           -1.206e+00  7.744e-01  -1.557 0.119530    </span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Fenerbahçe         -1.574e-01  5.923e-01  -0.266 0.790430    </span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Feyenoord           1.177e+00  5.877e-01   2.003 0.045161 *  </span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Fiorentina         -2.131e-01  6.567e-01  -0.325 0.745555    </span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Fortuna Sittard    -3.131e-01  5.839e-01  -0.536 0.591832    </span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Freiburg           -1.115e+00  6.698e-01  -1.665 0.095968 .  </span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Frosinone          -1.048e+00  6.710e-01  -1.562 0.118318    </span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Fulham             -1.652e+00  6.195e-01  -2.667 0.007661 ** </span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Galatasaray         1.391e+00  6.522e-01   2.133 0.032909 *  </span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Genk                2.242e+00  7.052e-01   3.179 0.001475 ** </span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Genoa              -1.920e-01  6.283e-01  -0.306 0.759871    </span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Gent                8.686e-01  6.056e-01   1.434 0.151524    </span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Getafe              1.068e+00  6.199e-01   1.722 0.085033 .  </span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Girona             -4.229e-01  5.798e-01  -0.729 0.465814    </span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Gladbach            1.069e-02  6.305e-01   0.017 0.986470    </span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Go Ahead Eag       -3.933e-01  2.058e+03   0.000 0.999848    </span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Gorica              1.241e+00  7.123e-01   1.743 0.081410 .  </span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Göztepe            -5.043e-01  5.609e-01  -0.899 0.368578    </span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Groningen           3.133e-01  5.645e-01   0.555 0.578953    </span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Guingamp           -6.813e-01  6.676e-01  -1.020 0.307509    </span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Hajduk Split        1.309e+00  7.536e-01   1.737 0.082343 .  </span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Hannover 96        -2.256e+00  6.999e-01  -3.223 0.001266 ** </span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Hartberg           -1.562e+00  6.877e-01  -2.271 0.023140 *  </span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Heerenveen          2.960e-02  6.065e-01   0.049 0.961072    </span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Heracles Almelo     3.022e-01  5.587e-01   0.541 0.588580    </span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Hertha BSC         -5.989e-01  6.420e-01  -0.933 0.350844    </span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Hoffenheim         -2.152e-01  6.599e-01  -0.326 0.744368    </span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Huddersfield       -2.516e+00  7.470e-01  -3.369 0.000756 ***</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Huesca             -5.840e-01  6.305e-01  -0.926 0.354375    </span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Inter               1.249e+00  6.062e-01   2.060 0.039418 *  </span></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Inter Zaprešić     -6.709e-01  7.021e-01  -0.956 0.339234    </span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Istra 1961         -1.134e+00  7.930e-01  -1.429 0.152862    </span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Jablonec           -1.349e+00  6.533e-01  -2.066 0.038872 *  </span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Juventus            2.470e+00  6.981e-01   3.538 0.000404 ***</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Karpaty Lviv       -1.252e+00  6.947e-01  -1.803 0.071419 .  </span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Karviná            -2.933e+00  6.949e-01  -4.221 2.43e-05 ***</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Kasımpaşa          -4.741e-01  5.637e-01  -0.841 0.400308    </span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Kayserispor        -2.706e-01  6.113e-01  -0.443 0.657982    </span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Konyaspor           1.101e-01  6.497e-01   0.170 0.865374    </span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Kortrijk            4.498e-01  6.262e-01   0.718 0.472582    </span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Krasnodar           2.712e+00  7.789e-01   3.481 0.000499 ***</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Larissa             2.095e-01  7.587e-01   0.276 0.782498    </span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a><span class="do">## ..LASK                1.029e+00  7.276e-01   1.415 0.157211    </span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Lazio               7.921e-01  5.750e-01   1.378 0.168350    </span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Leganés            -1.369e-02  5.801e-01  -0.024 0.981167    </span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Leicester City     -2.623e-01  5.576e-01  -0.470 0.638054    </span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Levadiakos         -7.175e-01  7.466e-01  -0.961 0.336524    </span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Levante             2.651e-02  5.853e-01   0.045 0.963874    </span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Leverkusen          2.013e-01  5.934e-01   0.339 0.734463    </span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Lille               1.889e+00  6.546e-01   2.885 0.003914 ** </span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Liverpool           3.327e+00  1.118e+00   2.975 0.002932 ** </span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Lokeren            -9.421e-01  6.794e-01  -1.387 0.165506    </span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Loko Moscow         2.663e+00  7.727e-01   3.446 0.000568 ***</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Lokomotiva          6.424e-01  7.147e-01   0.899 0.368791    </span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Lyon                1.730e+00  6.405e-01   2.701 0.006922 ** </span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Mačva Šabac         7.276e-01  6.496e-01   1.120 0.262713    </span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Mainz 05           -6.517e-01  6.209e-01  -1.050 0.293909    </span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Manchester City     2.078e+00  7.120e-01   2.919 0.003512 ** </span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Manchester Utd      4.705e-01  5.942e-01   0.792 0.428453    </span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Marítimo            1.001e-01  6.129e-01   0.163 0.870261    </span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Marseille           1.103e+00  5.948e-01   1.855 0.063618 .  </span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Mattersburg        -9.972e-01  6.855e-01  -1.455 0.145772    </span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Milan               1.392e+00  6.285e-01   2.215 0.026742 *  </span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Mladá Boleslav     -1.666e+00  7.097e-01  -2.347 0.018922 *  </span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Mladost Lučani      1.843e+00  6.831e-01   2.698 0.006974 ** </span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Monaco             -1.154e-01  6.357e-01  -0.181 0.856002    </span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Montpellier         1.359e+00  6.347e-01   2.141 0.032268 *  </span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Moreirense          7.191e-01  6.341e-01   1.134 0.256719    </span></span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a><span class="do">## ..NAC Breda          -1.061e+00  6.683e-01  -1.588 0.112330    </span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Nacional           -4.266e-01  6.708e-01  -0.636 0.524807    </span></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Nantes              4.731e-01  5.920e-01   0.799 0.424241    </span></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Napoli              1.815e+00  6.214e-01   2.920 0.003497 ** </span></span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Napredak Kruševac   1.473e+00  6.842e-01   2.152 0.031364 *  </span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a><span class="do">## ..NEC Nijmegen        1.517e+01  1.455e+03   0.010 0.991682    </span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Newcastle Utd      -4.438e-01  5.870e-01  -0.756 0.449664    </span></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Nice                1.041e+00  6.270e-01   1.660 0.096972 .  </span></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Nîmes               8.009e-01  5.925e-01   1.352 0.176450    </span></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Nizhny Novgorod     7.065e-01  1.581e+00   0.447 0.654979    </span></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Nürnberg           -2.672e+00  7.913e-01  -3.376 0.000735 ***</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a><span class="do">## ..OFI Crete           4.531e-01  7.740e-01   0.585 0.558275    </span></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Olimpik Donetsk    -1.271e+00  7.473e-01  -1.701 0.088875 .  </span></span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Olympiacos          3.769e+00  1.181e+00   3.192 0.001412 ** </span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Oostende           -1.738e-01  6.854e-01  -0.254 0.799831    </span></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Opava              -2.321e+00  6.821e-01  -3.403 0.000667 ***</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Orenburg            1.617e+00  7.334e-01   2.204 0.027493 *  </span></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Osijek              1.354e+00  7.345e-01   1.843 0.065354 .  </span></span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Oss                -1.623e+01  1.029e+03  -0.016 0.987416    </span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Panathinaikos       1.085e+00  7.583e-01   1.430 0.152643    </span></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Panetolikos         3.517e-01  7.529e-01   0.467 0.640444    </span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Panionios           4.308e-01  7.041e-01   0.612 0.540668    </span></span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a><span class="do">## ..PAOK                1.687e+01  2.462e+02   0.068 0.945396    </span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Paris S-G           2.587e+00  6.797e-01   3.806 0.000141 ***</span></span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Parma              -1.901e-02  5.960e-01  -0.032 0.974553    </span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Partizan            2.440e+00  7.233e-01   3.374 0.000741 ***</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a><span class="do">## ..PAS Giannina       -3.133e-01  7.475e-01  -0.419 0.675112    </span></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a><span class="do">## ..PAS Lamia           7.667e-01  7.946e-01   0.965 0.334565    </span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Portimonense        1.071e-01  6.441e-01   0.166 0.867966    </span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Porto               3.085e+00  8.388e-01   3.678 0.000235 ***</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Příbram            -2.650e+00  6.929e-01  -3.824 0.000131 ***</span></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Proleter NS         1.255e+00  7.014e-01   1.789 0.073694 .  </span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a><span class="do">## ..PSV Eindhoven       2.723e+00  7.692e-01   3.540 0.000400 ***</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rad                 2.183e-01  6.836e-01   0.319 0.749505    </span></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Radnički Niš        5.041e+00  1.252e+00   4.026 5.68e-05 ***</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Radnik Surdulica    1.016e+00  6.450e-01   1.575 0.115235    </span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rapid Wien         -8.912e-01  6.921e-01  -1.288 0.197859    </span></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rayo Vallecano     -6.143e-01  5.986e-01  -1.026 0.304768    </span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a><span class="do">## ..RB Leipzig          9.345e-01  6.670e-01   1.401 0.161195    </span></span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a><span class="do">## ..RB Salzburg         2.152e+00  8.667e-01   2.483 0.013033 *  </span></span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Real Madrid         9.388e-01  5.710e-01   1.644 0.100187    </span></span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Real Sociedad       4.991e-01  5.733e-01   0.871 0.383993    </span></span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Red Star            5.871e+00  1.375e+00   4.271 1.95e-05 ***</span></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Reims               1.218e+00  6.540e-01   1.862 0.062557 .  </span></span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rennes              8.730e-01  6.444e-01   1.355 0.175477    </span></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rijeka              1.610e+00  7.683e-01   2.095 0.036153 *  </span></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rio Ave             6.166e-01  6.549e-01   0.942 0.346432    </span></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rizespor           -1.565e-01  6.071e-01  -0.258 0.796639    </span></span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a><span class="do">## ..RKC Waalwijk        1.517e+01  1.455e+03   0.010 0.991682    </span></span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Roma                1.312e+00  6.198e-01   2.117 0.034221 *  </span></span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rostov              1.799e+00  7.628e-01   2.359 0.018324 *  </span></span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rubin Kazan         1.688e+00  8.056e-01   2.095 0.036184 *  </span></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Rudeš              -1.986e+00  8.553e-01  -2.323 0.020197 *  </span></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Saint-Étienne       1.465e+00  6.173e-01   2.373 0.017621 *  </span></span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Samara              7.065e-01  7.069e-01   0.999 0.317565    </span></span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sampdoria           6.058e-01  5.722e-01   1.059 0.289757    </span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Santa Clara         5.203e-01  6.583e-01   0.790 0.429299    </span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sassuolo            3.056e-02  6.583e-01   0.046 0.962969    </span></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Schalke 04         -1.160e+00  6.435e-01  -1.803 0.071415 .  </span></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a><span class="do">## ..SCR Altach         -1.419e+00  7.105e-01  -1.997 0.045831 *  </span></span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sevilla             5.959e-01  5.741e-01   1.038 0.299303    </span></span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Shakhtar            3.309e+00  1.154e+00   2.867 0.004143 ** </span></span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sigma Olomouc      -2.056e+00  6.834e-01  -3.008 0.002629 ** </span></span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sint-Truiden        1.094e+00  6.870e-01   1.592 0.111425    </span></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sivasspor          -3.188e-01  6.011e-01  -0.530 0.595853    </span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Slaven Belupo              NA         NA      NA       NA    </span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Slavia Prague       1.798e-01  7.065e-01   0.254 0.799178    </span></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Slovácko           -2.226e+00  6.737e-01  -3.304 0.000952 ***</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Slovan Liberec     -1.996e+00  6.859e-01  -2.910 0.003612 ** </span></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Southampton        -7.756e-01  6.022e-01  -1.288 0.197756    </span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a><span class="do">## ..SPAL                4.365e-02  5.942e-01   0.073 0.941438    </span></span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sparta Prague      -9.777e-01  6.542e-01  -1.494 0.135045    </span></span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sparta R'dam       -6.650e-01  1.530e+00  -0.435 0.663891    </span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Spartak Moscow      1.842e+00  7.275e-01   2.532 0.011334 *  </span></span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Spartak Subotica    9.952e-01  6.666e-01   1.493 0.135444    </span></span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sporting CP         2.036e+00  7.073e-01   2.878 0.003999 ** </span></span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a><span class="do">## ..St. Pölten         -1.049e+00  6.466e-01  -1.622 0.104865    </span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Standard Liège      1.185e+00  6.129e-01   1.933 0.053206 .  </span></span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Strasbourg          6.441e-01  6.350e-01   1.014 0.310427    </span></span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Sturm Graz         -6.224e-01  6.569e-01  -0.947 0.343396    </span></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Stuttgart          -1.530e+00  6.550e-01  -2.335 0.019524 *  </span></span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Teplice            -2.182e+00  6.954e-01  -3.138 0.001701 ** </span></span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Tom Tomsk           5.342e-01  1.616e+00   0.331 0.741021    </span></span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Tondela            -7.887e-03  6.568e-01  -0.012 0.990419    </span></span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Torino              1.299e+00  6.513e-01   1.995 0.046038 *  </span></span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Tottenham           4.640e-01  5.560e-01   0.835 0.403893    </span></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Toulouse                   NA         NA      NA       NA    </span></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Trabzonspor         9.996e-01  6.130e-01   1.631 0.102994    </span></span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Udinese                    NA         NA      NA       NA    </span></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Ufa                 5.342e-01  7.829e-01   0.682 0.494980    </span></span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Ural                1.436e+00  7.279e-01   1.973 0.048471 *  </span></span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Utrecht             7.628e-01  5.835e-01   1.307 0.191137    </span></span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Valencia            1.020e+00  6.334e-01   1.611 0.107143    </span></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Valladolid         -1.877e-01  5.929e-01  -0.317 0.751548    </span></span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Viktoria Plzeň             NA         NA      NA       NA    </span></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Villarreal                 NA         NA      NA       NA    </span></span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Vitesse             7.882e-01  6.063e-01   1.300 0.193625    </span></span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Vitória             8.690e-01  6.664e-01   1.304 0.192240    </span></span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Vitória Setúbal            NA         NA      NA       NA    </span></span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Vojvodina           1.082e+00  6.969e-01   1.553 0.120377    </span></span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Volyn Lutsk        -1.682e+01  1.455e+03  -0.012 0.990780    </span></span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Vorskla Poltava    -7.154e-01  6.571e-01  -1.089 0.276283    </span></span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Voždovac            7.312e-01  6.342e-01   1.153 0.248921    </span></span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a><span class="do">## ..VVV-Venlo           1.526e-01  5.755e-01   0.265 0.790943    </span></span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Waas-Beveren       -4.071e-01  7.494e-01  -0.543 0.586960    </span></span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Wacker Innsbr      -1.915e+00  7.028e-01  -2.725 0.006436 ** </span></span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Watford            -1.703e-01  5.670e-01  -0.300 0.763933    </span></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Werder Bremen       2.356e-01  6.461e-01   0.365 0.715320    </span></span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a><span class="do">## ..West Ham           -2.617e-01  5.568e-01  -0.470 0.638375    </span></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Willem II           2.752e-01  5.581e-01   0.493 0.621941    </span></span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Wolfsberger AC             NA         NA      NA       NA    </span></span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Wolfsburg                  NA         NA      NA       NA    </span></span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Wolves                     NA         NA      NA       NA    </span></span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Xanthi                     NA         NA      NA       NA    </span></span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Yeni Mal'spor              NA         NA      NA       NA    </span></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Zemun                      NA         NA      NA       NA    </span></span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Zenit               2.826e+00  7.643e-01   3.698 0.000218 ***</span></span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Zorya Luhansk              NA         NA      NA       NA    </span></span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Zulte Waregem              NA         NA      NA       NA    </span></span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a><span class="do">## ..Zwolle                     NA         NA      NA       NA    </span></span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 4691.2  on 3323  degrees of freedom</span></span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 3461.3  on 3061  degrees of freedom</span></span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 4069.8</span></span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">=</span> <span class="fu">as.data.frame</span>(BradleyTerry2<span class="sc">::</span><span class="fu">BTabilities</span>(fit))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">=</span> lambda_hat <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(ability))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">=</span> <span class="fu">rownames_to_column</span>(lambda_hat) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">team =</span> rowname)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>lambda_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  team       ability         s.e.
1                 PAOK  16.865424258  246.2486803
2         RKC Waalwijk  15.172802609 1455.3976480
3         NEC Nijmegen  15.172802609 1455.3983351
4   FC Kolos Kovalivka  14.141751526 1455.3976976
5             Red Star   5.870847663    1.3746661
6         Radnički Niš   5.040786848    1.2521379
7           Olympiacos   3.768760706    1.1806422
8        Dinamo Zagreb   3.354133394    0.9317167
9            Liverpool   3.326899235    1.1183687
10            Shakhtar   3.308790803    1.1540573
11             Benfica   3.134678265    0.8328164
12               Porto   3.085185051    0.8388456
13           Čukarički   2.848493867    0.7959128
14               Zenit   2.826021127    0.7642741
15       PSV Eindhoven   2.722792317    0.7691638
16           Krasnodar   2.711506241    0.7788643
17         Loko Moscow   2.662762309    0.7726573
18           Paris S-G   2.587199587    0.6797405
19                Ajax   2.546695691    0.7054231
20           Barcelona   2.540172497    0.7525521
21         CSKA Moscow   2.486508651    0.7702013
22            Juventus   2.469724654    0.6981466
23            Partizan   2.440393293    0.7232786
24                Genk   2.242227519    0.7052205
25        Arsenal Tula   2.233765849    0.7713170
26         RB Salzburg   2.151999250    0.8667404
27     Manchester City   2.078276715    0.7119963
28         Sporting CP   2.035751136    0.7072934
29               Lille   1.888636465    0.6546433
30      Mladost Lučani   1.843173704    0.6831429
31      Spartak Moscow   1.842173858    0.7274920
32          AEK Athens   1.816803645    0.7761954
33              Napoli   1.814772173    0.6214400
34       Akhmat Grozny   1.802462313    0.7497042
35              Rostov   1.799436385    0.7627930
36         Dynamo Kyiv   1.793251838    0.8029855
37         Club Brugge   1.786740828    0.6441804
38                Lyon   1.729654922    0.6404800
39         Rubin Kazan   1.687524596    0.8055557
40     Atlético Madrid   1.678241403    0.6414430
41       Bayern Munich   1.662051369    0.7153158
42               Braga   1.645348801    0.6671418
43            Dortmund   1.619478197    0.7220261
44            Orenburg   1.616789424    0.7334212
45              Rijeka   1.609672551    0.7682657
46           Atromitos   1.572879985    0.7679344
47   Napredak Kruševac   1.472687289    0.6841994
48       Saint-Étienne   1.465218304    0.6173272
49                Ural   1.436217234    0.7278563
50               Milan   1.392203228    0.6284581
51         Galatasaray   1.391207259    0.6521722
52          Başakşehir   1.378504555    0.6635872
53         Montpellier   1.358916354    0.6346877
54              Osijek   1.353564568    0.7345028
55                Roma   1.312491200    0.6198418
56        Hajduk Split   1.309110824    0.7535540
57              Torino   1.299416213    0.6513225
58         Proleter NS   1.254531171    0.7014403
59               Inter   1.248612816    0.6061814
60              Gorica   1.241198241    0.7122831
61               Reims   1.217924293    0.6539796
62      Standard Liège   1.184852054    0.6128817
63           Feyenoord   1.177325325    0.5877358
64           Marseille   1.103269830    0.5948040
65            Atalanta   1.093689982    0.5903573
66        Sint-Truiden   1.093517334    0.6869604
67       Panathinaikos   1.084625658    0.7583434
68           Vojvodina   1.082438771    0.6969125
69              Getafe   1.067644791    0.6199294
70                Nice   1.040711128    0.6270429
71            Beşiktaş   1.033946993    0.6101856
72                LASK   1.029186155    0.7275904
73            Valencia   1.020458354    0.6333655
74          AZ Alkmaar   1.017255363    0.6114993
75    Radnik Surdulica   1.015932116    0.6449975
76                Aris   1.008648424    0.7079258
77         Trabzonspor   0.999552893    0.6130320
78    Spartak Subotica   0.995162136    0.6665630
79         Dynamo Mosc   0.974041537    0.8013629
80         Real Madrid   0.938754149    0.5710361
81             Antwerp   0.937114953    0.6071926
82          RB Leipzig   0.934524797    0.6670111
83              Rennes   0.872992183    0.6443631
84             Vitória   0.868986302    0.6664102
85                Gent   0.868602725    0.6056482
86             Chelsea   0.863829895    0.6233599
87               Nîmes   0.800936352    0.5925102
88               Lazio   0.792112786    0.5750262
89             Vitesse   0.788192432    0.6063343
90           PAS Lamia   0.766736278    0.7945784
91          Anderlecht   0.764387143    0.6147828
92             Utrecht   0.762764858    0.5835007
93            Voždovac   0.731230257    0.6342119
94         Mačva Šabac   0.727550700    0.6495972
95          Moreirense   0.719134506    0.6340565
96               B-SAD   0.709651470    0.7094136
97              Samara   0.706494388    0.7068665
98     Nizhny Novgorod   0.706494388    1.5810314
99          Strasbourg   0.644102606    0.6350057
100         Lokomotiva   0.642365724    0.7147401
101            Arsenal   0.616871534    0.5922922
102            Rio Ave   0.616620240    0.6549107
103          Sampdoria   0.605790493    0.5722262
104             Angers   0.600125185    0.6662124
105            Sevilla   0.595873101    0.5740981
106           Espanyol   0.571117441    0.5869428
107                Ufa   0.534235165    0.7828658
108          Tom Tomsk   0.534235165    1.6164402
109        Santa Clara   0.520337965    0.6583297
110          Charleroi   0.507553408    0.6238624
111      Real Sociedad   0.499085537    0.5732910
112       ADO Den Haag   0.483858116    0.5790670
113           Boavista   0.481256369    0.6218166
114             Nantes   0.473056015    0.5919973
115     Manchester Utd   0.470541850    0.5942379
116      Athletic Club   0.466822495    0.5969227
117          Tottenham   0.464045698    0.5559509
118          OFI Crete   0.453077216    0.7739535
119           Kortrijk   0.449761022    0.6261608
120          Panionios   0.430756814    0.7040776
121             Alavés   0.369593870    0.5777394
122     Excel Mouscron   0.367626107    0.6609176
123        Panetolikos   0.351685804    0.7529494
124    FC Oleksandriya   0.335872433    0.6601715
125          Groningen   0.313273052    0.5645434
126    Heracles Almelo   0.302214994    0.5587321
127          Willem II   0.275199533    0.5581001
128              Betis   0.270563777    0.5619340
129           Bordeaux   0.259796916    0.6040239
130      Werder Bremen   0.235643885    0.6460954
131                Rad   0.218275425    0.6836220
132              Anzhi   0.216587602    0.7401735
133    Asteras Tripoli   0.213336919    0.7551373
134            Larissa   0.209457396    0.7587237
135         Leverkusen   0.201276247    0.5933945
136      Dinamo Vranje   0.195981771    0.6188776
137      Slavia Prague   0.179754065    0.7065485
138            Bologna   0.178330840    0.5851580
139          VVV-Venlo   0.152570379    0.5755494
140              Eibar   0.115442869    0.6005606
141          Konyaspor   0.110148090    0.6496975
142       Portimonense   0.107075722    0.6440952
143           Marítimo   0.100107755    0.6129306
144        FC Mariupol   0.085876724    0.6332784
145               Aves   0.081227119    0.6294891
146               SPAL   0.043652795    0.5942152
147           Sassuolo   0.030564680    0.6583136
148         Heerenveen   0.029600911    0.6064648
149            Levante   0.026511457    0.5853334
150           Gladbach   0.010692841    0.6305329
151      Bačka Palanka   0.007686386    0.6557091
152            Yenisey   0.000000000    0.0000000
153             Amiens  -0.005771883    0.6289752
154            Tondela  -0.007886962    0.6567608
155            Leganés  -0.013693743    0.5800857
156              Parma  -0.019011472    0.5959919
157              Emmen  -0.033814664    0.5741465
158              Eupen  -0.061349264    0.6129237
159         Celta Vigo  -0.104568119    0.5795611
160             Monaco  -0.115366564    0.6357490
161     Eint Frankfurt  -0.130537862    0.6351922
162             Empoli  -0.148495201    0.5757572
163            Everton  -0.156431763    0.5783296
164           Rizespor  -0.156453395    0.6071170
165         Fenerbahçe  -0.157392751    0.5922523
166           Cagliari  -0.159889945    0.5935074
167            Watford  -0.170288032    0.5670221
168           Oostende  -0.173806617    0.6854490
169              Dijon  -0.186908661    0.6163061
170             Chaves  -0.187104103    0.6598214
171         Valladolid  -0.187707765    0.5928871
172              Genoa  -0.192037152    0.6282896
173        Antalyaspor  -0.196109013    0.5593389
174         Fiorentina  -0.213087214    0.6566510
175         Hoffenheim  -0.215168712    0.6598754
176               Caen  -0.240484699    0.6468915
177           West Ham  -0.261688912    0.5568175
178     Leicester City  -0.262323326    0.5576347
179        Kayserispor  -0.270640371    0.6113388
180    Fortuna Sittard  -0.313090610    0.5839241
181       PAS Giannina  -0.313317068    0.7475204
182          Sivasspor  -0.318817049    0.6011180
183      Cercle Brugge  -0.359988261    0.6496026
184         Alanyaspor  -0.366559348    0.5764182
185       Go Ahead Eag  -0.393265640 2058.2430107
186          Excelsior  -0.393265640    0.5796455
187         Ankaragücü  -0.406855103    0.5677352
188       Waas-Beveren  -0.407111626    0.7494053
189     Crystal Palace  -0.410359365    0.5641626
190             Girona  -0.422869530    0.5798236
191           Nacional  -0.426611806    0.6708234
192      Newcastle Utd  -0.443757845    0.5870001
193          Kasımpaşa  -0.474098260    0.5636835
194            Göztepe  -0.504335022    0.5609084
195          Bursaspor  -0.571220431    0.6451853
196             Huesca  -0.583955398    0.6305282
197            FC Lviv  -0.597706001    0.7091104
198        Bournemouth  -0.598318184    0.5750370
199         Hertha BSC  -0.598930458    0.6419730
200       Austria Wien  -0.599184430    0.6382936
201     Rayo Vallecano  -0.614302237    0.5985822
202         Sturm Graz  -0.622391939    0.6568940
203           Mainz 05  -0.651705169    0.6209171
204      De Graafschap  -0.665005320    0.5847632
205       Sparta R'dam  -0.665005320    1.5303425
206     Inter Zaprešić  -0.670949184    0.7020654
207           Guingamp  -0.681265327    0.6676045
208    Vorskla Poltava  -0.715387231    0.6570983
209         Levadiakos  -0.717525463    0.7466005
210         Düsseldorf  -0.734237850    0.6001109
211     BB Erzurumspor  -0.760490707    0.5951122
212        Southampton  -0.775596270    0.6021839
213            Burnley  -0.826179124    0.5711045
214         Rapid Wien  -0.891157674    0.6920670
215    Desna Chernihiv  -0.901539057    0.6594518
216            Lokeren  -0.942119184    0.6793520
217      Sparta Prague  -0.977654840    0.6541687
218        Mattersburg  -0.997196923    0.6855338
219       Cardiff City  -1.031145311    0.5650223
220          Frosinone  -1.048070500    0.6710354
221         St. Pölten  -1.048605932    0.6466038
222          NAC Breda  -1.061179433    0.6683304
223           Brighton  -1.098906572    0.6043623
224           Freiburg  -1.115004807    0.6697847
225         Istra 1961  -1.133516567    0.7929496
226        Akhisarspor  -1.146282518    0.6298105
227         Schalke 04  -1.160042322    0.6434572
228           Feirense  -1.205579158    0.7744208
229       Karpaty Lviv  -1.252476191    0.6947369
230    Olimpik Donetsk  -1.271480168    0.7473312
231           Jablonec  -1.349467675    0.6533262
232           Augsburg  -1.408232925    0.6413657
233         SCR Altach  -1.418780573    0.7104757
234       Chornomorets  -1.424316723    0.6933348
235          Stuttgart  -1.529571346    0.6549569
236           Hartberg  -1.561927828    0.6877338
237       Arsenal-Kyiv  -1.628437173    0.6876401
238             Fulham  -1.652111184    0.6195443
239     Mladá Boleslav  -1.665705827    0.7096984
240             Admira  -1.698561360    0.7223639
241      Baník Ostrava  -1.863103951    0.6709751
242      Wacker Innsbr  -1.914808020    0.7027532
243    Apollon Smyrnis  -1.927050126    0.9076705
244              Rudeš  -1.986464522    0.8552523
245     Slovan Liberec  -1.996219557    0.6859441
246             Chievo  -2.050541154    0.8535614
247      Sigma Olomouc  -2.055684127    0.6833744
248        Fastav Zlín  -2.122380375    0.6773509
249            Teplice  -2.182341433    0.6954379
250           Slovácko  -2.226037134    0.6736550
251        Hannover 96  -2.256063849    0.6998872
252              Opava  -2.321158618    0.6821492
253     Bohemians 1905  -2.327743126    0.7151856
254       Huddersfield  -2.516357551    0.7470194
255            Příbram  -2.649817998    0.6929140
256           Nürnberg  -2.671712508    0.7913279
257            Karviná  -2.933500216    0.6949102
258       Dukla Prague  -3.591314946    0.7524555
259          Den Bosch -15.959333889 2520.8225381
260            Cambuur -16.231073569 1455.3976499
261                Oss -16.231073569 1029.1226023
262        Volyn Lutsk -16.818544439 1455.3976982
263        Almere City -31.797141818 2058.2430120</code></pre>
</div>
</div>
<p>Given the summary of the Bradley-Terry model and its resulting team strengths, it seems that the results were relatively sensitive to positive results for teams in skewed competitions. In other words, in leagues that are typically dominated by a small number of teams (Greece, Czechia), results over and by the top teams in the competitions were “rewarded” more than their counterparts in other “fairer” competitions (England, Spain). Subjectively, clubs like Red Star typically dominant their domestic competition, which means we would expect a high “ability” assignment, like we see in this model.</p>
<p>For the sake of our project, we’ll only focus on the strengths of the clubs competing in the 2019-20 UEFA Champions League group stages. From this, we see the aforementioned Red Star leading in “domestic strength”, along with other dominant teams from smaller nations, like Olympiacos from Greece and Dinamo Zagreb from Croatia. This aligns with our prior assumptions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 4
   Home          Country ability  s.e.
   &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 Red Star      " rs"      5.87 1.37 
 2 Olympiacos    " gr"      3.77 1.18 
 3 Dinamo Zagreb " hr"      3.35 0.932
 4 Liverpool     " eng"     3.33 1.12 
 5 Shakhtar      " ua"      3.31 1.15 
 6 Benfica       " pt"      3.13 0.833
 7 Zenit         " ru"      2.83 0.764
 8 Loko Moscow   " ru"      2.66 0.773
 9 Paris S-G     " fr"      2.59 0.680
10 Ajax          " nl"      2.55 0.705
# ℹ 22 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="starting-out-using-markov-chains-to-simulate-round-of-16" class="level2">
<h2 class="anchored" data-anchor-id="starting-out-using-markov-chains-to-simulate-round-of-16">Starting Out: Using Markov Chains to Simulate Round of 16</h2>
<p>While our project is focused primarily on rounds past the Round of 16, we still wanted to have a baseline understanding of simulating the UEFA Champions League competition. Therefore, we elected to simulate the Round of 16 based on real life match-ups. However, unlike our models described later in this report, we did not use a Bradley-Terry + binomial simulation. Instead, to observe and analyze the differences between modelling and simulation methodologies, we pursued a simulation using Markov Chains.</p>
<div class="cell">
<details class="code-fold">
<summary>Data manipulation for Markov chain simulation</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ucl <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'../data/raw/UEFA_Champions_League_2020_Results_RAW.csv'</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ucl <span class="ot">=</span> ucl <span class="sc">%&gt;%</span>  </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Country_Away =</span> <span class="fu">str_extract</span>(Away, <span class="st">"^[A-Za-z]{2,3}(?=</span><span class="sc">\\</span><span class="st">s)"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Country_Home =</span> <span class="fu">str_extract</span>(ucl<span class="sc">$</span>Home, <span class="st">" [a-z]{2,3}$"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Home =</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(Home, <span class="st">" [a-z]{2,3}$"</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Away =</span> <span class="fu">str_remove</span>(Away, <span class="st">"^[A-Za-z]{2,3}</span><span class="sc">\\</span><span class="st">s+"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>uefa_playoff_teams <span class="ot">=</span> ucl <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Round of 16"</span>, <span class="st">"Quarter-finals"</span>, <span class="st">"Semi-finals"</span>, <span class="st">"Final"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Home, Away) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>ucl_group <span class="ot">&lt;-</span> ucl <span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Round <span class="sc">==</span> <span class="st">"Group stage"</span>, HomeGoals <span class="sc">!=</span> AwayGoals)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>ucl_teams <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(ucl_group<span class="sc">$</span>Home, ucl_group<span class="sc">$</span>Away)))</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>domestic_restricted <span class="ot">&lt;-</span> all <span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Home =</span> <span class="fu">as.character</span>(Home), <span class="at">Away =</span> <span class="fu">as.character</span>(Away)) <span class="sc">%&gt;%</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Home <span class="sc">%in%</span> ucl_teams <span class="sc">|</span> Away <span class="sc">%in%</span> ucl_teams) <span class="sc">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HomeGoals <span class="sc">!=</span> AwayGoals) <span class="sc">%&gt;%</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(Round, <span class="st">"play-offs"</span>) <span class="sc">|</span> <span class="fu">is.na</span>(Round))</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>wt_ucl <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>wt_dom <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>bt_dom <span class="ot">&lt;-</span> domestic_restricted <span class="sc">%&gt;%</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.team =</span> Home,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.team =</span> Away,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.win  =</span> <span class="fu">as.integer</span>(HomeGoals <span class="sc">&gt;</span> AwayGoals),</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.win  =</span> <span class="fu">as.integer</span>(AwayGoals <span class="sc">&gt;</span> HomeGoals),</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">Competition =</span> <span class="st">"Domestic"</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>bt_ucl <span class="ot">&lt;-</span> ucl_group <span class="sc">%&gt;%</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.team =</span> Home,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.team =</span> Away,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.win  =</span> <span class="fu">as.integer</span>(HomeGoals <span class="sc">&gt;</span> AwayGoals),</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.win  =</span> <span class="fu">as.integer</span>(AwayGoals <span class="sc">&gt;</span> HomeGoals),</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">Competition =</span> <span class="st">"UCL"</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>bt_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(bt_dom, bt_ucl) <span class="sc">%&gt;%</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">w =</span> <span class="fu">ifelse</span>(Competition <span class="sc">==</span> <span class="st">"UCL"</span>, wt_ucl, wt_dom))</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>unik_teams_all <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(bt_all<span class="sc">$</span>home.team, bt_all<span class="sc">$</span>away.team)))</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>bt_all <span class="ot">&lt;-</span> bt_all <span class="sc">%&gt;%</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.team =</span> <span class="fu">factor</span>(home.team, <span class="at">levels =</span> unik_teams_all),</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.team =</span> <span class="fu">factor</span>(away.team, <span class="at">levels =</span> unik_teams_all)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fitting the BT model, we get:</p>
<div class="cell">
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
##               team  ability     s.e.
## 1         Juventus 22.95331 5376.529
## 2        Liverpool 22.93649 5376.529
## 3        Barcelona 22.88233 5376.529
## 4  Manchester City 22.40969 5376.529
## 5           Napoli 22.30021 5376.529
## 6    Bayern Munich 21.86009 5376.529
## 7         Dortmund 21.63099 5376.529
## 8  Atlético Madrid 21.57971 5376.529
## 9         Atalanta 21.24216 5376.529
## 10        Valencia 21.13025 5376.529
## 11         Chelsea 20.98055 5376.529
## 12     Real Madrid 20.94026 5376.529
## 13      RB Leipzig 20.93525 5376.529
## 14       Paris S-G 20.75123 5376.529
## 15       Tottenham 20.43087 5376.529
## 16            Lyon 19.50695 5376.529</code></pre>
</div>
<p>From the results, we see that Juventus, Liverpool, and Barcelona are at the top of the ability category. These teams all had strong rosters and strong domestic results as well as group stage results. At the bottom, as expected we see teams less prestigious like Atalanta and Valencia. The standard error is all the same, which is because since all the teams didn’t play each other for example Bayern never played Valencia, so we get disconnected graphs. For this round of 16 simulation, this doesn’t make a huge deal.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Since the round of 16 for the Champions League Tournament had 2 legs before COVID officially shut down the tournament, we need to simulate both legs of the contest. However our Bradley-Terry model has limitations where it doesn’t predict score just the overall winner. For 2 leg contests, this shows a problem where aggregate score decides the winner. If both teams win one game, the Bradley Terry model doesn’t know who wins the whole round. Also, if one team wins marginally, and the other team wins by a lot, it still looks like 1 win and 1 loss to the Bradley Terry model. This is the reason that we want to get the scores of the matchups, so we shift for this round specifically to a Markov Chain model modeling states of the games using the Bradley-Terry strengths to simulate goal scores and state changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>total_gpm <span class="ot">&lt;-</span> <span class="fl">2.7</span>   <span class="co"># constant, estimated how many goals are scored per game</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>beta      <span class="ot">&lt;-</span> <span class="fl">0.9</span>   <span class="co"># how strongly BT ability difference tilts scoring share</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>hfa       <span class="ot">&lt;-</span> <span class="fl">0.28</span>  <span class="co"># home-field advantage in the scoring-share logit</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>et_scale  <span class="ot">&lt;-</span> <span class="fl">0.75</span>  <span class="co"># scoring slows in extra time</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">25</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>inv_logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>x))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>lambda_vec_raw <span class="ot">&lt;-</span> <span class="fu">setNames</span>(lambda_hat_combined<span class="sc">$</span>ability, lambda_hat_combined<span class="sc">$</span>team)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>get_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(team) {<span class="co">#helper to get BT scores</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(team) <span class="sc">&amp;&amp;</span> team <span class="sc">%in%</span> <span class="fu">names</span>(lambda_vec_raw)) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    lambda_vec_raw[[team]]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>r16_ties <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>tie_id, <span class="sc">~</span>home_first_leg,     <span class="sc">~</span>away_first_leg,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-1"</span>, <span class="st">"Atalanta"</span>,          <span class="st">"Valencia"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-2"</span>, <span class="st">"Dortmund"</span>,          <span class="st">"Paris S-G"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-3"</span>, <span class="st">"Atletico Madrid"</span>,   <span class="st">"Liverpool"</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-4"</span>, <span class="st">"Tottenham"</span>,         <span class="st">"RB Leipzig"</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-5"</span>, <span class="st">"Chelsea"</span>,           <span class="st">"Bayern Munich"</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-6"</span>, <span class="st">"Napoli"</span>,            <span class="st">"Barcelona"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-7"</span>, <span class="st">"Real Madrid"</span>,       <span class="st">"Manchester City"</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"R16-8"</span>, <span class="st">"Lyon"</span>,              <span class="st">"Juventus"</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>r16_ties</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  tie_id home_first_leg  away_first_leg 
  &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;          
1 R16-1  Atalanta        Valencia       
2 R16-2  Dortmund        Paris S-G      
3 R16-3  Atletico Madrid Liverpool      
4 R16-4  Tottenham       RB Leipzig     
5 R16-5  Chelsea         Bayern Munich  
6 R16-6  Napoli          Barcelona      
7 R16-7  Real Madrid     Manchester City
8 R16-8  Lyon            Juventus       </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Helper methods for Markov chain and Monte Carlo simulation</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sim_match_markov <span class="ot">&lt;-</span> <span class="cf">function</span>(Home, Away, <span class="at">neutral=</span><span class="cn">FALSE</span>, <span class="at">allow_et=</span><span class="cn">TRUE</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  lamH <span class="ot">&lt;-</span> <span class="fu">get_lambda</span>(Home); lamA <span class="ot">&lt;-</span> <span class="fu">get_lambda</span>(Away)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  r_tot <span class="ot">&lt;-</span> total_gpm <span class="sc">/</span> <span class="dv">90</span>   <span class="co"># goal p per min</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  s_home <span class="ot">&lt;-</span> <span class="fu">inv_logit</span>(beta <span class="sc">*</span> (lamH <span class="sc">-</span> lamA) <span class="sc">+</span> <span class="fu">ifelse</span>(neutral, <span class="dv">0</span>, hfa))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  pH <span class="ot">&lt;-</span> r_tot <span class="sc">*</span> s_home</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  pA <span class="ot">&lt;-</span> r_tot <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> s_home)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#first 90 mins</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  gH <span class="ot">&lt;-</span> <span class="dv">0</span>L; gA <span class="ot">&lt;-</span> <span class="dv">0</span>L</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>) {</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (u <span class="sc">&lt;</span> pH) gH <span class="ot">&lt;-</span> gH <span class="sc">+</span> <span class="dv">1</span>L <span class="cf">else</span> <span class="cf">if</span> (u <span class="sc">&lt;</span> pH <span class="sc">+</span> pA) gA <span class="ot">&lt;-</span> gA <span class="sc">+</span> <span class="dv">1</span>L</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#extra time - scale p to show scoring in ET</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (allow_et <span class="sc">&amp;&amp;</span> gH <span class="sc">==</span> gA) {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    pH_et <span class="ot">&lt;-</span> pH <span class="sc">*</span> et_scale; pA_et <span class="ot">&lt;-</span> pA <span class="sc">*</span> et_scale</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) {</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (u <span class="sc">&lt;</span> pH_et) gH <span class="ot">&lt;-</span> gH <span class="sc">+</span> <span class="dv">1</span>L <span class="cf">else</span> <span class="cf">if</span> (u <span class="sc">&lt;</span> pH_et <span class="sc">+</span> pA_et) gA <span class="ot">&lt;-</span> gA <span class="sc">+</span> <span class="dv">1</span>L</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (gH <span class="sc">==</span> gA) {</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Penalties </span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>      base <span class="ot">&lt;-</span> <span class="fl">0.76</span>; tilt <span class="ot">&lt;-</span> <span class="fl">0.02</span> <span class="co">#tilt nudges odds towards stronger team</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>      p_home <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">min</span>(base <span class="sc">+</span> tilt <span class="sc">*</span> <span class="fu">tanh</span>(lamH <span class="sc">-</span> lamA), <span class="fl">0.95</span>), <span class="fl">0.55</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>      p_away <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">min</span>(base <span class="sc">-</span> tilt <span class="sc">*</span> <span class="fu">tanh</span>(lamH <span class="sc">-</span> lamA), <span class="fl">0.95</span>), <span class="fl">0.55</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>      a <span class="ot">&lt;-</span> b <span class="ot">&lt;-</span> <span class="dv">0</span>L</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) { a <span class="ot">&lt;-</span> a <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_home); b <span class="ot">&lt;-</span> b <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_away) }</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a <span class="sc">!=</span> b) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">gH=</span>gH, <span class="at">gA=</span>gA, <span class="at">mode=</span><span class="st">"PK"</span>, <span class="at">winner=</span><span class="fu">ifelse</span>(a<span class="sc">&gt;</span>b,<span class="st">"home"</span>,<span class="st">"away"</span>)))</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">repeat</span> {</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        aa <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_home); bb <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_away)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (aa <span class="sc">!=</span> bb) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">gH=</span>gH, <span class="at">gA=</span>gA, <span class="at">mode=</span><span class="st">"PK"</span>, <span class="at">winner=</span><span class="fu">ifelse</span>(aa<span class="sc">&gt;</span>bb,<span class="st">"home"</span>,<span class="st">"away"</span>)))</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">gH=</span>gH, <span class="at">gA=</span>gA, <span class="at">mode=</span><span class="st">"ET"</span>, <span class="at">winner=</span><span class="fu">ifelse</span>(gH<span class="sc">&gt;</span>gA,<span class="st">"home"</span>,<span class="st">"away"</span>)))</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">gH=</span>gH, <span class="at">gA=</span>gA, <span class="at">mode=</span><span class="st">"FT"</span>, <span class="at">winner=</span><span class="fu">ifelse</span>(gH<span class="sc">&gt;</span>gA,<span class="st">"home"</span>,<span class="st">"away"</span>))</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>sim_two_leg_markov <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B, <span class="at">away_goals_rule=</span><span class="cn">TRUE</span>) {</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Leg 1: A home</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  L1 <span class="ot">&lt;-</span> <span class="fu">sim_match_markov</span>(A, B, <span class="at">neutral=</span><span class="cn">FALSE</span>, <span class="at">allow_et=</span><span class="cn">FALSE</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Leg 2: B home</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  L2 <span class="ot">&lt;-</span> <span class="fu">sim_match_markov</span>(B, A, <span class="at">neutral=</span><span class="cn">FALSE</span>, <span class="at">allow_et=</span><span class="cn">FALSE</span>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  aggA <span class="ot">&lt;-</span> L1<span class="sc">$</span>gH <span class="sc">+</span> L2<span class="sc">$</span>gA</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  aggB <span class="ot">&lt;-</span> L1<span class="sc">$</span>gA <span class="sc">+</span> L2<span class="sc">$</span>gH</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (aggA <span class="sc">!=</span> aggB) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">winner=</span><span class="fu">ifelse</span>(aggA<span class="sc">&gt;</span>aggB, A, B),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>                                <span class="at">aggA=</span>aggA, <span class="at">aggB=</span>aggB, <span class="at">decided=</span><span class="st">"AGG"</span>))</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (away_goals_rule) {</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    A_away <span class="ot">&lt;-</span> L2<span class="sc">$</span>gA; B_away <span class="ot">&lt;-</span> L1<span class="sc">$</span>gA</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (A_away <span class="sc">!=</span> B_away)</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">winner=</span><span class="fu">ifelse</span>(A_away<span class="sc">&gt;</span>B_away, A, B),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                  <span class="at">aggA=</span>aggA, <span class="at">aggB=</span>aggB, <span class="at">decided=</span><span class="st">"AWAY_GOALS"</span>))</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ET in Leg 2 (B home)</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  lamB <span class="ot">&lt;-</span> <span class="fu">get_lambda</span>(B); lamA <span class="ot">&lt;-</span> <span class="fu">get_lambda</span>(A)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  r_tot <span class="ot">&lt;-</span> total_gpm <span class="sc">/</span> <span class="dv">90</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  s_home <span class="ot">&lt;-</span> <span class="fu">inv_logit</span>(beta <span class="sc">*</span> (lamB <span class="sc">-</span> lamA) <span class="sc">+</span> hfa)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  pH_et <span class="ot">&lt;-</span> (r_tot <span class="sc">*</span> s_home) <span class="sc">*</span> et_scale</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  pA_et <span class="ot">&lt;-</span> (r_tot <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> s_home)) <span class="sc">*</span> et_scale</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  gH_et <span class="ot">&lt;-</span> <span class="dv">0</span>L; gA_et <span class="ot">&lt;-</span> <span class="dv">0</span>L</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) {</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (u <span class="sc">&lt;</span> pH_et) gH_et <span class="ot">&lt;-</span> gH_et <span class="sc">+</span> <span class="dv">1</span>L <span class="cf">else</span> <span class="cf">if</span> (u <span class="sc">&lt;</span> pH_et <span class="sc">+</span> pA_et) gA_et <span class="ot">&lt;-</span> gA_et <span class="sc">+</span> <span class="dv">1</span>L</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  aggA2 <span class="ot">&lt;-</span> aggA <span class="sc">+</span> gA_et</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  aggB2 <span class="ot">&lt;-</span> aggB <span class="sc">+</span> gH_et</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (aggA2 <span class="sc">!=</span> aggB2)</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">winner=</span><span class="fu">ifelse</span>(aggA2<span class="sc">&gt;</span>aggB2, A, B),</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>                <span class="at">aggA=</span>aggA2, <span class="at">aggB=</span>aggB2, <span class="at">decided=</span><span class="st">"ET"</span>))</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PKs</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>  base <span class="ot">&lt;-</span> <span class="fl">0.76</span>; tilt <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  p_home <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">min</span>(base <span class="sc">+</span> tilt <span class="sc">*</span> <span class="fu">tanh</span>(lamB <span class="sc">-</span> lamA), <span class="fl">0.95</span>), <span class="fl">0.55</span>)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  p_away <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">min</span>(base <span class="sc">-</span> tilt <span class="sc">*</span> <span class="fu">tanh</span>(lamB <span class="sc">-</span> lamA), <span class="fl">0.95</span>), <span class="fl">0.55</span>)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> b <span class="ot">&lt;-</span> <span class="dv">0</span>L</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) { a <span class="ot">&lt;-</span> a <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_home); b <span class="ot">&lt;-</span> b <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_away) }</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (a <span class="sc">!=</span> b) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">winner=</span><span class="fu">ifelse</span>(a<span class="sc">&gt;</span>b, B, A),</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>                          <span class="at">aggA=</span>aggA2, <span class="at">aggB=</span>aggB2, <span class="at">decided=</span><span class="st">"PK"</span>))</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">repeat</span> {</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    aa <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_home); bb <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="dv">1</span>,p_away)</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (aa <span class="sc">!=</span> bb) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">winner=</span><span class="fu">ifelse</span>(aa<span class="sc">&gt;</span>bb, B, A),</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>                              <span class="at">aggA=</span>aggA2, <span class="at">aggB=</span>aggB2, <span class="at">decided=</span><span class="st">"PK"</span>))</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>simulate_r16_mc <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">N=</span><span class="dv">5000</span>, <span class="at">away_goals_rule=</span><span class="cn">TRUE</span>) {</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(r16_ties)), <span class="cf">function</span>(i) {</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    A <span class="ot">&lt;-</span> r16_ties<span class="sc">$</span>home_first_leg[i]</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">&lt;-</span> r16_ties<span class="sc">$</span>away_first_leg[i]</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    winsA <span class="ot">&lt;-</span> <span class="dv">0</span>L; sumAggA <span class="ot">&lt;-</span> <span class="dv">0</span>; sumAggB <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">sim_two_leg_markov</span>(A, B, <span class="at">away_goals_rule=</span>away_goals_rule)</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (out<span class="sc">$</span>winner <span class="sc">==</span> A) winsA <span class="ot">&lt;-</span> winsA <span class="sc">+</span> <span class="dv">1</span>L</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>      sumAggA <span class="ot">&lt;-</span> sumAggA <span class="sc">+</span> out<span class="sc">$</span>aggA</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>      sumAggB <span class="ot">&lt;-</span> sumAggB <span class="sc">+</span> out<span class="sc">$</span>aggB</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    pA <span class="ot">&lt;-</span> winsA <span class="sc">/</span> N</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">tie_id =</span> r16_ties<span class="sc">$</span>tie_id[i],</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">team_A =</span> A, <span class="at">team_B =</span> B,</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_adv_A =</span> pA,</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_adv_B =</span> <span class="dv">1</span> <span class="sc">-</span> pA,</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">se_A =</span> <span class="fu">sqrt</span>(pA<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>pA)<span class="sc">/</span>N),</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_agg_A =</span> sumAggA <span class="sc">/</span> N,</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_agg_B =</span> sumAggB <span class="sc">/</span> N</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(tie_id)</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we’ll run a Markov simulation to get the probability a team will win out of N times, which also gets the average aggregate scores between two teams. This shows us how many times a team would be expected to win based on our BT strengths and the tie’s match-up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>r16_results <span class="ot">&lt;-</span> <span class="fu">simulate_r16_mc</span>(<span class="at">N=</span>N, <span class="at">away_goals_rule=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(r16_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 8
  tie_id team_A          team_B    p_adv_A p_adv_B    se_A mean_agg_A mean_agg_B
  &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 R16-1  Atalanta        Valencia   0.542    0.458 7.05e-3      2.85        2.59
2 R16-2  Dortmund        Paris S-G  0.804    0.196 5.61e-3      3.68        1.72
3 R16-3  Atletico Madrid Liverpool  0.0008   0.999 4.00e-4      0           5.39
4 R16-4  Tottenham       RB Leipz…  0.307    0.693 6.52e-3      2.13        3.27
5 R16-5  Chelsea         Bayern M…  0.185    0.815 5.50e-3      1.75        3.75
6 R16-6  Napoli          Barcelona  0.270    0.730 6.28e-3      2.02        3.39
7 R16-7  Real Madrid     Manchest…  0.083    0.917 3.90e-3      1.19        4.25
8 R16-8  Lyon            Juventus   0.0044   0.996 9.36e-4      0.235       5.21</code></pre>
</div>
</div>
<p>From the Monte Carlo results, we see that: - Atalanta is favored over Valencia slightly, reflecting Atalanta’s win in real life. - Dortmund is heavily favored over PSG, which was wrong by the model, the BT including the group stage ranked PSG very low which was interesting - Liverpool is heavily favored over Atlético Madrid, similar to real life where an upset happened and Atlético Madrid pulled out the victory - Leipzig is favored 0.7 to 0.3 to Tottenham, aligning with real life - Bayern is favored 0.8 to 0.2, aligning with real life where Bayern won - Barcelona is favored 0.7 to 0.3 to Napoli, where Barcelona pulled out the win - Manchester City was heavily favored against Real Madrid, 0.9 to 0.1 where Manchester City won in real life - With the biggest upset, Lyon won in real life vs Juventus, which is 0.99 percent to win showing a large upset from our model’s expectation</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>More helpers for Markov chain simulations</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#helper to simulate match using markov function</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>play_neutral <span class="ot">&lt;-</span> <span class="cf">function</span>(A, B) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">sim_match_markov</span>(<span class="at">Home =</span> A, <span class="at">Away =</span> B, <span class="at">neutral =</span> <span class="cn">TRUE</span>, <span class="at">allow_et =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (out<span class="sc">$</span>winner <span class="sc">==</span> <span class="st">"home"</span>) A <span class="cf">else</span> B</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>simulate_tournament_once <span class="ot">&lt;-</span> <span class="cf">function</span>(r16_results) {</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  winners_r16 <span class="ot">&lt;-</span> r16_results <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(tie_id) <span class="sc">%&gt;%</span>                 </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">A_wins =</span> <span class="fu">runif</span>(<span class="fu">n</span>()) <span class="sc">&lt;</span> p_adv_A,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">winner =</span> <span class="fu">ifelse</span>(A_wins, team_A, team_B)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  qf1_A <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-1"</span>]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  qf1_B <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-2"</span>]</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  qf2_A <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-3"</span>]</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  qf2_B <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-4"</span>]</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  qf3_A <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-5"</span>]</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  qf3_B <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-6"</span>]</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  qf4_A <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-7"</span>]</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  qf4_B <span class="ot">&lt;-</span> winners_r16<span class="sc">$</span>winner[winners_r16<span class="sc">$</span>tie_id <span class="sc">==</span> <span class="st">"R16-8"</span>]</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  qf1_w <span class="ot">&lt;-</span> <span class="fu">play_neutral</span>(qf1_A, qf1_B)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  qf2_w <span class="ot">&lt;-</span> <span class="fu">play_neutral</span>(qf2_A, qf2_B)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  qf3_w <span class="ot">&lt;-</span> <span class="fu">play_neutral</span>(qf3_A, qf3_B)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  qf4_w <span class="ot">&lt;-</span> <span class="fu">play_neutral</span>(qf4_A, qf4_B)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  sf1_w <span class="ot">&lt;-</span> <span class="fu">play_neutral</span>(qf1_w, qf2_w)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  sf2_w <span class="ot">&lt;-</span> <span class="fu">play_neutral</span>(qf3_w, qf4_w)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  champion <span class="ot">&lt;-</span> <span class="fu">play_neutral</span>(sf1_w, sf2_w)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">champion =</span> champion,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_A =</span> sf1_w,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_B =</span> sf2_w</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>simulate_tournament_field <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">M =</span> <span class="dv">5000</span>, r16_results) {</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  champs   <span class="ot">&lt;-</span> <span class="fu">character</span>(M)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  finals_A <span class="ot">&lt;-</span> <span class="fu">character</span>(M)</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  finals_B <span class="ot">&lt;-</span> <span class="fu">character</span>(M)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="fu">seq_len</span>(M)) {</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    sim <span class="ot">&lt;-</span> <span class="fu">simulate_tournament_once</span>(r16_results)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    champs[m]   <span class="ot">&lt;-</span> sim<span class="sc">$</span>champion</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    finals_A[m] <span class="ot">&lt;-</span> sim<span class="sc">$</span>final_A</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    finals_B[m] <span class="ot">&lt;-</span> sim<span class="sc">$</span>final_B</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  sims <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_id  =</span> <span class="fu">seq_len</span>(M),</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">champion =</span> champs,</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_A  =</span> finals_A,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_B  =</span> finals_B</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  title_probs <span class="ot">&lt;-</span> sims <span class="sc">%&gt;%</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(champion, <span class="at">name =</span> <span class="st">"titles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_sims =</span> <span class="fu">sum</span>(titles),</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">pct =</span> titles <span class="sc">/</span> total_sims</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(pct))</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>  final_matchups <span class="ot">&lt;-</span> sims <span class="sc">%&gt;%</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">team1 =</span> <span class="fu">pmin</span>(final_A, final_B),</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">team2 =</span> <span class="fu">pmax</span>(final_A, final_B)</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(team1, team2, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_sims =</span> <span class="fu">sum</span>(n),</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">pct =</span> n <span class="sc">/</span> total_sims</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(pct))</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">title_probs    =</span> title_probs,</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_matchups =</span> final_matchups,</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">raw_sims       =</span> sims</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">25</span>)</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>tourn_out <span class="ot">&lt;-</span> <span class="fu">simulate_tournament_field</span>(M, r16_results)</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>tourn_out<span class="sc">$</span>title_probs       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 4
   champion        titles total_sims    pct
   &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;  &lt;dbl&gt;
 1 Liverpool         2203       5000 0.441 
 2 Juventus          1254       5000 0.251 
 3 Barcelona          833       5000 0.167 
 4 Manchester City    290       5000 0.058 
 5 Dortmund           134       5000 0.0268
 6 Napoli             132       5000 0.0264
 7 Bayern Munich       74       5000 0.0148
 8 Atalanta            28       5000 0.0056
 9 Valencia            22       5000 0.0044
10 RB Leipzig          18       5000 0.0036
11 Paris S-G            7       5000 0.0014
12 Chelsea              3       5000 0.0006
13 Tottenham            2       5000 0.0004</code></pre>
</div>
<details class="code-fold">
<summary>More helpers for Markov chain simulations</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tourn_out<span class="sc">$</span>final_matchups    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 37 × 5
   team1         team2               n total_sims    pct
   &lt;chr&gt;         &lt;chr&gt;           &lt;int&gt;      &lt;int&gt;  &lt;dbl&gt;
 1 Juventus      Liverpool        1641       5000 0.328 
 2 Barcelona     Liverpool        1203       5000 0.241 
 3 Liverpool     Manchester City   587       5000 0.117 
 4 Liverpool     Napoli            270       5000 0.054 
 5 Dortmund      Juventus          241       5000 0.0482
 6 Bayern Munich Liverpool         224       5000 0.0448
 7 Barcelona     Dortmund          188       5000 0.0376
 8 Atalanta      Juventus           80       5000 0.016 
 9 Dortmund      Manchester City    80       5000 0.016 
10 Juventus      RB Leipzig         58       5000 0.0116
# ℹ 27 more rows</code></pre>
</div>
</div>
</section>
<section id="fitting-bradley-terry-model-based-on-domestic-league-ucl-group-stage-and-round-of-16-results" class="level2">
<h2 class="anchored" data-anchor-id="fitting-bradley-terry-model-based-on-domestic-league-ucl-group-stage-and-round-of-16-results">Fitting Bradley-Terry Model based on Domestic League + UCL Group Stage and Round of 16 results</h2>
<p>Now, we’ll move on from using Markov chains to using Bradley-Terry models to define latent team strengths, covariate coefficients, and pairwise probabilities. For these two models, we’ll focus on the quarterfinals through the final round, instead of worrying about the round of 16, which wasn’t affected by the COVID-19 pandemic.</p>
<p>For this Bradley-Terry model, we fit our lambdas on the domestic league data that we sourced earlier combined with group stage and round of 16 results from the 2019-2020 tournament.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Atalanta"        "RB Leipzig"      "Barcelona"       "Manchester City"
[5] "Lyon"            "Paris S-G"       "Atlético Madrid" "Bayern Munich"  </code></pre>
</div>
</div>
<p>These are the 8 teams that advanced to the semifinals in real life, we’ll use these to filter our strengths and compute match-up probabilities once they’re defined.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>no_ties_combined <span class="ot">=</span> all_combined <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HomeGoals <span class="sc">!=</span> AwayGoals) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Home_Winner =</span> <span class="fu">as.numeric</span>(HomeGoals <span class="sc">&gt;</span> AwayGoals),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Opp_Winner  =</span> <span class="fu">as.numeric</span>(AwayGoals <span class="sc">&gt;</span> HomeGoals))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>unik_teams <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(no_ties_combined<span class="sc">$</span>Home, no_ties_combined<span class="sc">$</span>Away)))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>results_combined <span class="ot">=</span> no_ties_combined <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">home.team =</span> Home, <span class="at">away.team =</span> Away) <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(home.team, away.team) <span class="sc">%&gt;%</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.win =</span> <span class="fu">sum</span>(Home_Winner),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.win =</span> <span class="fu">sum</span>(Opp_Winner),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.team =</span> <span class="fu">factor</span>(home.team, <span class="at">levels =</span> unik_teams),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.team =</span> <span class="fu">factor</span>(away.team, <span class="at">levels =</span> unik_teams)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>fit_all <span class="ot">=</span> <span class="fu">BTm</span>(</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">cbind</span>(home.win, away.win),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1 =</span> home.team,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">player2 =</span> away.team,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">refcat =</span> <span class="st">"Yenisey"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> results_combined</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>combined_lambda_hat <span class="ot">=</span> <span class="fu">as.data.frame</span>(BradleyTerry2<span class="sc">::</span><span class="fu">BTabilities</span>(fit_all)) <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"team"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ability))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>combined_lambda_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   team       ability         s.e.
1         Slavia Prague  2.067900e+01 3.956180e+03
2        Viktoria Plzeň  2.049829e+01 3.956180e+03
3         Sparta Prague  1.952134e+01 3.956180e+03
4              Jablonec  1.914797e+01 3.956180e+03
5                  PAOK  1.886543e+01 6.693690e+02
6        Mladá Boleslav  1.886308e+01 3.956180e+03
7         Baník Ostrava  1.863311e+01 3.956180e+03
8        Slovan Liberec  1.850539e+01 3.956180e+03
9         Sigma Olomouc  1.844173e+01 3.956180e+03
10          Fastav Zlín  1.841409e+01 3.956180e+03
11             Slovácko  1.827149e+01 3.956180e+03
12              Teplice  1.824840e+01 3.956180e+03
13                Opava  1.817716e+01 3.956180e+03
14       Bohemians 1905  1.816893e+01 3.956180e+03
15              Příbram  1.785311e+01 3.956180e+03
16              Karviná  1.756607e+01 3.956180e+03
17         RKC Waalwijk  1.715739e+01 3.956180e+03
18         NEC Nijmegen  1.715739e+01 3.956181e+03
19         Dukla Prague  1.690374e+01 3.956180e+03
20        de RB Leipzig  1.685433e+01 2.291988e+03
21   FC Kolos Kovalivka  1.614175e+01 3.956180e+03
22             Red Star  5.870848e+00 1.374666e+00
23         Radnički Niš  5.040787e+00 1.252138e+00
24           Olympiacos  3.768761e+00 1.180644e+00
25        Dinamo Zagreb  3.354133e+00 9.317167e-01
26            Liverpool  3.326899e+00 1.118369e+00
27             Shakhtar  3.308791e+00 1.154057e+00
28              Benfica  3.134678e+00 8.328164e-01
29                Porto  3.085185e+00 8.388456e-01
30            Čukarički  2.848494e+00 7.959128e-01
31                Zenit  2.826021e+00 7.642741e-01
32        PSV Eindhoven  2.723984e+00 7.700615e-01
33            Krasnodar  2.711506e+00 7.788643e-01
34          Loko Moscow  2.662762e+00 7.726573e-01
35            Paris S-G  2.587200e+00 6.797405e-01
36                 Ajax  2.552878e+00 7.061374e-01
37            Barcelona  2.540172e+00 7.525521e-01
38          CSKA Moscow  2.486509e+00 7.702013e-01
39             Juventus  2.469725e+00 6.981466e-01
40             Partizan  2.440393e+00 7.232786e-01
41                 Genk  2.242228e+00 7.052205e-01
42         Arsenal Tula  2.233766e+00 7.713170e-01
43          RB Salzburg  2.153589e+00 8.668297e-01
44      Manchester City  2.078277e+00 7.119963e-01
45          Sporting CP  2.035751e+00 7.072934e-01
46                Lille  1.888636e+00 6.546433e-01
47       Mladost Lučani  1.843174e+00 6.831429e-01
48       Spartak Moscow  1.842174e+00 7.274920e-01
49           AEK Athens  1.816804e+00 7.761954e-01
50               Napoli  1.814772e+00 6.214400e-01
51        Akhmat Grozny  1.802462e+00 7.497042e-01
52               Rostov  1.799436e+00 7.627930e-01
53          Dynamo Kyiv  1.793252e+00 8.029855e-01
54          Club Brugge  1.786741e+00 6.441804e-01
55                 Lyon  1.729655e+00 6.404800e-01
56          Rubin Kazan  1.687525e+00 8.055557e-01
57      Atlético Madrid  1.678241e+00 6.414430e-01
58        Bayern Munich  1.662051e+00 7.153158e-01
59                Braga  1.645349e+00 6.671418e-01
60             Dortmund  1.619478e+00 7.220261e-01
61             Orenburg  1.616789e+00 7.334212e-01
62               Rijeka  1.609673e+00 7.682657e-01
63            Atromitos  1.572880e+00 7.679344e-01
64    Napredak Kruševac  1.472687e+00 6.841994e-01
65        Saint-Étienne  1.465218e+00 6.173272e-01
66                 Ural  1.436217e+00 7.278563e-01
67                Milan  1.392203e+00 6.284581e-01
68          Galatasaray  1.391207e+00 6.521722e-01
69           Başakşehir  1.378505e+00 6.635872e-01
70          Montpellier  1.358916e+00 6.346877e-01
71               Osijek  1.353565e+00 7.345028e-01
72                 Roma  1.312491e+00 6.198418e-01
73         Hajduk Split  1.309111e+00 7.535540e-01
74               Torino  1.299416e+00 6.513225e-01
75          Proleter NS  1.254531e+00 7.014403e-01
76                Inter  1.248613e+00 6.061814e-01
77               Gorica  1.241198e+00 7.122831e-01
78                Reims  1.217924e+00 6.539796e-01
79       Standard Liège  1.184852e+00 6.128817e-01
80            Feyenoord  1.183114e+00 5.888753e-01
81            Marseille  1.103270e+00 5.948040e-01
82             Atalanta  1.093690e+00 5.903573e-01
83         Sint-Truiden  1.093517e+00 6.869604e-01
84        Panathinaikos  1.084626e+00 7.583435e-01
85            Vojvodina  1.082439e+00 6.969125e-01
86               Getafe  1.067645e+00 6.199294e-01
87                 Nice  1.040711e+00 6.270429e-01
88             Beşiktaş  1.033947e+00 6.101856e-01
89                 LASK  1.031111e+00 7.276283e-01
90           AZ Alkmaar  1.029735e+00 6.127522e-01
91             Valencia  1.020458e+00 6.333655e-01
92     Radnik Surdulica  1.015932e+00 6.449975e-01
93                 Aris  1.008648e+00 7.079259e-01
94          Trabzonspor  9.995529e-01 6.130320e-01
95     Spartak Subotica  9.951621e-01 6.665630e-01
96          Dynamo Mosc  9.740415e-01 8.013629e-01
97              Utrecht  9.574768e-01 5.744493e-01
98          Real Madrid  9.387541e-01 5.710361e-01
99              Antwerp  9.371150e-01 6.071926e-01
100          RB Leipzig  9.345248e-01 6.670111e-01
101              Rennes  8.729922e-01 6.443631e-01
102             Vitória  8.689863e-01 6.664102e-01
103                Gent  8.686027e-01 6.056482e-01
104             Chelsea  8.638299e-01 6.233599e-01
105               Nîmes  8.009364e-01 5.925102e-01
106               Lazio  7.921128e-01 5.750262e-01
107           PAS Lamia  7.667363e-01 7.945784e-01
108          Anderlecht  7.643871e-01 6.147828e-01
109            Voždovac  7.312303e-01 6.342119e-01
110         Mačva Šabac  7.275507e-01 6.495972e-01
111          Moreirense  7.191345e-01 6.340565e-01
112               B-SAD  7.096515e-01 7.094136e-01
113              Samara  7.064944e-01 7.068665e-01
114     Nizhny Novgorod  7.064944e-01 1.581031e+00
115             Vitesse  6.573468e-01 5.805688e-01
116          Strasbourg  6.441026e-01 6.350057e-01
117          Lokomotiva  6.423657e-01 7.147401e-01
118             Arsenal  6.168715e-01 5.922922e-01
119             Rio Ave  6.166202e-01 6.549107e-01
120           Sampdoria  6.057905e-01 5.722262e-01
121              Angers  6.001252e-01 6.662124e-01
122             Sevilla  5.958731e-01 5.740981e-01
123            Espanyol  5.711174e-01 5.869428e-01
124                 Ufa  5.342352e-01 7.828658e-01
125           Tom Tomsk  5.342352e-01 1.616440e+00
126         Santa Clara  5.203380e-01 6.583297e-01
127           Charleroi  5.075534e-01 6.238624e-01
128       Real Sociedad  4.990855e-01 5.732910e-01
129        ADO Den Haag  4.937796e-01 5.802162e-01
130            Boavista  4.812564e-01 6.218166e-01
131              Nantes  4.730560e-01 5.919973e-01
132      Manchester Utd  4.705419e-01 5.942379e-01
133       Athletic Club  4.668225e-01 5.969227e-01
134           Tottenham  4.640457e-01 5.559509e-01
135           OFI Crete  4.530772e-01 7.739535e-01
136            Kortrijk  4.497610e-01 6.261608e-01
137         Dortmund de  4.419040e-01 3.770031e+03
138           Panionios  4.307568e-01 7.040777e-01
139              Alavés  3.695939e-01 5.777394e-01
140      Excel Mouscron  3.676261e-01 6.609176e-01
141         Panetolikos  3.516858e-01 7.529494e-01
142     FC Oleksandriya  3.358724e-01 6.601715e-01
143           Groningen  3.237855e-01 5.553181e-01
144           Willem II  2.745973e-01 5.588120e-01
145               Betis  2.705638e-01 5.619340e-01
146            Bordeaux  2.597969e-01 6.040239e-01
147       Werder Bremen  2.356439e-01 6.460954e-01
148                 Rad  2.182754e-01 6.836220e-01
149               Anzhi  2.165876e-01 7.401735e-01
150     Asteras Tripoli  2.133369e-01 7.551374e-01
151     Heracles Almelo  2.097977e-01 5.521944e-01
152             Larissa  2.094574e-01 7.587238e-01
153          Leverkusen  2.012762e-01 5.933945e-01
154              Inđija  1.959818e-01 1.543700e+00
155       Dinamo Vranje  1.959818e-01 6.188776e-01
156             Bologna  1.783308e-01 5.851580e-01
157           VVV-Venlo  1.412868e-01 5.759657e-01
158               Eibar  1.154429e-01 6.005606e-01
159           Konyaspor  1.101481e-01 6.496975e-01
160        Portimonense  1.070757e-01 6.440952e-01
161            Marítimo  1.001078e-01 6.129306e-01
162         FC Mariupol  8.587672e-02 6.332784e-01
163                Aves  8.122712e-02 6.294891e-01
164                SPAL  4.365279e-02 5.942152e-01
165          Heerenveen  3.762747e-02 6.078364e-01
166            Sassuolo  3.056468e-02 6.583136e-01
167             Levante  2.651146e-02 5.853334e-01
168            Gladbach  1.069284e-02 6.305329e-01
169       Bačka Palanka  7.686386e-03 6.557091e-01
170             Yenisey  0.000000e+00 0.000000e+00
171              Amiens -5.771883e-03 6.289752e-01
172             Tondela -7.886962e-03 6.567608e-01
173             Leganés -1.369374e-02 5.800857e-01
174               Parma -1.901147e-02 5.959919e-01
175               Emmen -2.750741e-02 5.750557e-01
176               Eupen -6.134926e-02 6.129237e-01
177          Celta Vigo -1.045681e-01 5.795611e-01
178          Benfica pt -1.122434e-01 2.318216e+03
179              Monaco -1.153666e-01 6.357490e-01
180      Eint Frankfurt -1.305379e-01 6.351922e-01
181              Empoli -1.484952e-01 5.757572e-01
182             Everton -1.564318e-01 5.783296e-01
183            Rizespor -1.564534e-01 6.071170e-01
184          Fenerbahçe -1.573928e-01 5.922523e-01
185            Cagliari -1.598899e-01 5.935074e-01
186             Watford -1.702880e-01 5.670221e-01
187            Oostende -1.738066e-01 6.854490e-01
188               Dijon -1.869087e-01 6.163061e-01
189              Chaves -1.871041e-01 6.598214e-01
190          Valladolid -1.877078e-01 5.928871e-01
191               Genoa -1.920372e-01 6.282896e-01
192         Antalyaspor -1.961090e-01 5.593389e-01
193          Fiorentina -2.130872e-01 6.566510e-01
194          Hoffenheim -2.151687e-01 6.598754e-01
195                Caen -2.404847e-01 6.468915e-01
196            West Ham -2.616889e-01 5.568175e-01
197      Leicester City -2.623233e-01 5.576347e-01
198         Kayserispor -2.706404e-01 6.113388e-01
199        PAS Giannina -3.133171e-01 7.475204e-01
200           Sivasspor -3.188170e-01 6.011180e-01
201     Fortuna Sittard -3.231976e-01 5.843170e-01
202       Cercle Brugge -3.599883e-01 6.496026e-01
203          Alanyaspor -3.665593e-01 5.764182e-01
204          Ankaragücü -4.068551e-01 5.677352e-01
205        Waas-Beveren -4.071116e-01 7.494053e-01
206        Go Ahead Eag -4.086753e-01 5.594884e+03
207           Excelsior -4.086753e-01 5.796519e-01
208      Crystal Palace -4.103594e-01 5.641626e-01
209              Girona -4.228695e-01 5.798236e-01
210            Nacional -4.266118e-01 6.708234e-01
211       Newcastle Utd -4.437578e-01 5.870001e-01
212           Kasımpaşa -4.740983e-01 5.636835e-01
213             Göztepe -5.043350e-01 5.609084e-01
214         Juventus it -5.251833e-01 2.450244e+03
215           Bursaspor -5.712204e-01 6.451853e-01
216              Huesca -5.839554e-01 6.305282e-01
217        Austria Wien -5.969248e-01 6.380548e-01
218             FC Lviv -5.977060e-01 7.091104e-01
219         Bournemouth -5.983182e-01 5.750370e-01
220          Hertha BSC -5.989305e-01 6.419730e-01
221      Rayo Vallecano -6.143022e-01 5.985822e-01
222          Sturm Graz -6.419580e-01 6.437721e-01
223            Mainz 05 -6.517052e-01 6.209171e-01
224        Sparta R'dam -6.668188e-01 1.530635e+00
225       De Graafschap -6.668188e-01 5.855277e-01
226      Inter Zaprešić -6.709492e-01 7.020654e-01
227            Guingamp -6.812653e-01 6.676045e-01
228     Vorskla Poltava -7.153872e-01 6.570983e-01
229          Levadiakos -7.175255e-01 7.466005e-01
230          Düsseldorf -7.342379e-01 6.001109e-01
231      BB Erzurumspor -7.604907e-01 5.951122e-01
232         Southampton -7.755963e-01 6.021839e-01
233          Rapid Wien -7.972374e-01 6.687406e-01
234             Burnley -8.261791e-01 5.711045e-01
235     Desna Chernihiv -9.015391e-01 6.594518e-01
236             Lokeren -9.421192e-01 6.793520e-01
237        Cardiff City -1.031145e+00 5.650223e-01
238          St. Pölten -1.046664e+00 6.462649e-01
239           Frosinone -1.048071e+00 6.710354e-01
240         Mattersburg -1.061628e+00 6.796629e-01
241           NAC Breda -1.067705e+00 6.689792e-01
242            Brighton -1.098907e+00 6.043623e-01
243            Freiburg -1.115005e+00 6.697847e-01
244          Istra 1961 -1.133517e+00 7.929496e-01
245         Akhisarspor -1.146283e+00 6.298105e-01
246          Schalke 04 -1.160042e+00 6.434572e-01
247            Feirense -1.205579e+00 7.744208e-01
248        Karpaty Lviv -1.252476e+00 6.947369e-01
249     Olimpik Donetsk -1.271480e+00 7.473312e-01
250            Augsburg -1.408233e+00 6.413657e-01
251          SCR Altach -1.417764e+00 7.094258e-01
252        Chornomorets -1.424317e+00 6.933348e-01
253           Stuttgart -1.529571e+00 6.549569e-01
254            Hartberg -1.559088e+00 6.863494e-01
255        Arsenal-Kyiv -1.628437e+00 6.876401e-01
256              Fulham -1.652111e+00 6.195443e-01
257              Admira -1.683925e+00 7.206157e-01
258       Wacker Innsbr -1.908354e+00 7.007663e-01
259     Apollon Smyrnis -1.927050e+00 9.076705e-01
260               Rudeš -1.986465e+00 8.552523e-01
261              Chievo -2.050541e+00 8.535614e-01
262         Hannover 96 -2.256064e+00 6.998872e-01
263        Huddersfield -2.516358e+00 7.470194e-01
264            Nürnberg -2.671713e+00 7.913279e-01
265    de Bayern Munich -7.617026e+00 8.290074e+03
266        es Barcelona -1.191332e+01 8.524029e+03
267         ua Shakhtar -1.466319e+01 5.091949e+03
268 eng Manchester City -1.472026e+01 4.853919e+03
269        fr Paris S-G -1.607926e+01 2.950960e+03
270             fr Lyon -1.625928e+01 1.870282e+03
271           Platanias -1.711299e+01 3.956180e+03
272    cz Slavia Prague -1.712416e+01 5.464842e+03
273                Lens -1.775298e+01 3.956180e+03
274           Den Bosch -1.797474e+01 6.852305e+03
275                 Oss -1.823289e+01 2.797442e+03
276             Cambuur -1.823289e+01 3.956180e+03
277             Šibenik -1.869959e+01 3.956180e+03
278         Volyn Lutsk -1.881854e+01 3.956180e+03
279  Atlético Madrid es -2.020036e+01 9.184209e+03
280             Lyon fr -2.277753e+01 8.374800e+03
281        Barcelona es -2.594335e+01 8.348941e+03
282       Olympiacos gr -2.713114e+01 9.144530e+03
283       Tottenham eng -2.714591e+01 9.124805e+03
284        Paris S-G fr -2.788454e+01 7.756100e+03
285            Inter it -2.827080e+01 8.245321e+03
286    Bayern Munich de -3.028500e+01 4.016770e+03
287      Real Madrid es -3.149903e+01 5.457230e+03
288    Dinamo Zagreb hr -3.152112e+01 4.112685e+03
289 Manchester City eng -3.172594e+01 2.297304e+03
290       RB Leipzig de -3.218546e+01 2.487600e+03
291         Atalanta it -3.222925e+01 3.205710e+03
292         Almere City -3.579896e+01 5.594884e+03
293      ru Loko Moscow -3.650287e+01 8.940130e+03
294       de Leverkusen -3.801366e+01 1.021718e+04
295         it Juventus -3.809457e+01 8.472808e+03
296          pt Benfica -3.943760e+01 8.744292e+03
297            it Inter -4.264779e+01 8.459734e+03
298         de Dortmund -4.462827e+01 7.956856e+03
299      be Club Brugge -4.545061e+01 8.706805e+03
300         rs Red Star -4.664524e+01 4.503380e+03
301      es Real Madrid -4.739044e+01 2.751582e+03
302       eng Tottenham -4.770184e+01 2.829763e+03
303         eng Chelsea -4.796304e+01 4.279509e+03
304             nl Ajax -4.801295e+01 4.821084e+03
305      tr Galatasaray -4.827781e+01 5.977036e+03
306         it Atalanta -4.832199e+01 3.158811e+03
307         es Valencia -4.845842e+01 3.531779e+03
308            ru Zenit -4.861789e+01 3.350476e+03
309    hr Dinamo Zagreb -4.956892e+01 3.801523e+03
310           Napoli it -5.147946e+01 1.007629e+04
311       Leverkusen de -5.322956e+01 8.553646e+03
312           it Napoli -5.506686e+01 5.487062e+05
313    Slavia Prague cz -6.085319e+01 8.117602e+03
314         Red Star rs -6.322062e+01 3.166686e+03
315      Galatasaray tr -6.382279e+01 3.550826e+03
316      Club Brugge be -6.382279e+01 3.550826e+03
317         Shakhtar ua -6.461259e+01 3.788080e+03
318         Chelsea eng -6.484020e+01 3.977654e+03
319            Lille fr -6.555209e+01 4.935300e+03
320         Valencia es -6.560201e+01 3.854493e+03
321             Ajax nl -6.563548e+01 3.931223e+03
322       eng Liverpool -6.781082e+01 9.847756e+03
323  es Atlético Madrid -6.829458e+01 8.628339e+03
324       gr Olympiacos -7.909770e+01 3.594276e+03
325            fr Lille -8.288521e+01 4.028614e+03
326      RB Salzburg at -8.419040e+01 9.602086e+03
327      Loko Moscow ru -8.427268e+01 8.811721e+03
328       Liverpool eng -8.434022e+01 8.824387e+03
329      at RB Salzburg -1.007696e+02 9.104507e+03
330             be Genk -1.010473e+02 9.192351e+03
331             Genk be -1.171990e+02 9.376261e+03
332       Slaven Belupo            NA           NA
333            Toulouse            NA           NA
334             Udinese            NA           NA
335          Villarreal            NA           NA
336     Vitória Setúbal            NA           NA
337    Vysočina Jihlava            NA           NA
338      Wolfsberger AC            NA           NA
339           Wolfsburg            NA           NA
340              Wolves            NA           NA
341              Xanthi            NA           NA
342       Yeni Mal'spor            NA           NA
343               Zemun            NA           NA
344            Zenit ru            NA           NA
345       Zorya Luhansk            NA           NA
346       Zulte Waregem            NA           NA
347              Zwolle            NA           NA</code></pre>
</div>
</div>
<p>Above, we get coefficients similar to our domestic strengths, but with significantly smaller standard errors (s.e.) than when we fit our strengths without the group stage and round of 16 results. With that said, a lot of our top performers, as seen above and below, are from the same competitions-namely the top four all come from the Czech league.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">=</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(combined_lambda_hat <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(ability)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>), <span class="fu">aes</span>(<span class="fu">reorder</span>(team, <span class="sc">-</span>ability), ability)) <span class="sc">+</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 Teams by UCL 2019-2020 Group Stage + RO16 Performance Strength"</span>, <span class="at">x =</span> <span class="st">"Club"</span>, <span class="at">y =</span> <span class="st">"Team Strength λ"</span>) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We’ll now filter the abilities by quarterfinal participants, where we see PSG placing first, with Barcelona and Manchester City closely following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>combined_lambda_hat <span class="ot">=</span> combined_lambda_hat <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(team <span class="sc">%in%</span> uefa_playoff_teams)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>combined_lambda_hat <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(ability))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             team   ability      s.e.
1       Paris S-G 2.5871996 0.6797405
2       Barcelona 2.5401725 0.7525521
3 Manchester City 2.0782767 0.7119963
4            Lyon 1.7296549 0.6404800
5 Atlético Madrid 1.6782414 0.6414430
6   Bayern Munich 1.6620514 0.7153158
7        Atalanta 1.0936900 0.5903573
8      RB Leipzig 0.9345248 0.6670111</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>strength_plot <span class="ot">=</span> combined_lambda_hat <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ability)) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(team, ability), <span class="at">y =</span> ability)) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#1f78b4"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(ability, <span class="dv">2</span>)),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Playoff Teams Strengths"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Bradley–Terry Model Estimated Team Abilities (λ)"</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Team"</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Ability (λ)"</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">"gray30"</span>),</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>strength_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  avg_goals
      &lt;dbl&gt;
1      3.21</code></pre>
</div>
</div>
<section id="simulation" class="level4">
<h4 class="anchored" data-anchor-id="simulation">Simulation</h4>
<p>Now, we’ll actually simulate the tournament as if it took place over two-legs instead of one, starting at the quarterfinals. In this simulation, in order to break ties where teams “split the series,” we use a Poisson distribution defined using <em>goals for</em> in the group stage for a particular team to draw a sample representing that team’s goals scored. In the real competition, this is defined as an “aggregate” over two legs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute win probabilities</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>possible_matchups <span class="ot">=</span> quarters <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(combined_lambda_hat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(team, ability),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Hi"</span> <span class="ot">=</span> <span class="st">"team"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Hi_ability =</span> ability) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(combined_lambda_hat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(team, ability),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Lo"</span> <span class="ot">=</span> <span class="st">"team"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Lo_ability =</span> ability) <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># expected goal rate scaling based on relative Bradley-Terry abilities</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hi_lambda =</span> <span class="fu">exp</span>(Hi_ability) <span class="sc">/</span> (<span class="fu">exp</span>(Hi_ability) <span class="sc">+</span> <span class="fu">exp</span>(Lo_ability)) <span class="sc">*</span> <span class="fl">3.205357</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lo_lambda =</span> <span class="fu">exp</span>(Lo_ability) <span class="sc">/</span> (<span class="fu">exp</span>(Hi_ability) <span class="sc">+</span> <span class="fu">exp</span>(Lo_ability)) <span class="sc">*</span> <span class="fl">3.205357</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function for 2-leg tie using aggregate goals</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>simulate_two_leg_goals <span class="ot">=</span> <span class="cf">function</span>(ability_hi, ability_lo, <span class="at">avg_goals =</span> <span class="fl">3.205357</span>) {</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert BT abilities into expected goal rates per match</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  lambda_hi <span class="ot">=</span> <span class="fu">exp</span>(ability_hi) <span class="sc">/</span> (<span class="fu">exp</span>(ability_hi) <span class="sc">+</span> <span class="fu">exp</span>(ability_lo)) <span class="sc">*</span> avg_goals</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  lambda_lo <span class="ot">=</span> <span class="fu">exp</span>(ability_lo) <span class="sc">/</span> (<span class="fu">exp</span>(ability_hi) <span class="sc">+</span> <span class="fu">exp</span>(ability_lo)) <span class="sc">*</span> avg_goals</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate goals for each of the two legs </span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Each team plays two matches, goals ~ Poisson distributed</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  leg1_hi <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda_hi)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  leg1_lo <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda_lo)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  leg2_hi <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda_hi)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  leg2_lo <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda_lo)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate total goals across both legs </span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  total_hi <span class="ot">=</span> leg1_hi <span class="sc">+</span> leg2_hi</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  total_lo <span class="ot">=</span> leg1_lo <span class="sc">+</span> leg2_lo</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decide winner based on aggregate goals </span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (total_hi <span class="sc">&gt;</span> total_lo) {</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span>)  <span class="co"># Hi team advances</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (total_lo <span class="sc">&gt;</span> total_hi) {</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)  <span class="co"># Lo team advances</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tie after two legs</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute win probability based on relative abilities</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    prob_hi_wins_tiebreak <span class="ot">=</span> <span class="fu">exp</span>(ability_hi) <span class="sc">/</span> (<span class="fu">exp</span>(ability_hi) <span class="sc">+</span> <span class="fu">exp</span>(ability_lo))</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, prob_hi_wins_tiebreak))  <span class="co"># weighted shootout</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>possible_matchups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Hi              Lo Hi_ability Lo_ability Hi_lambda Lo_lambda
1        Atalanta       Paris S-G  1.0936900   2.587200 0.5878482 2.6175088
2      RB Leipzig Atlético Madrid  0.9345248   1.678241 1.0327403 2.1726167
3       Barcelona   Bayern Munich  2.5401725   1.662051 2.2643691 0.9409879
4 Manchester City            Lyon  2.0782767   1.729655 1.8792474 1.3261096</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Simulation of quarterfinals through final with combined domestic and UCL-fitted Bradley-Terry model</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>n_sims <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>alt_results <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Match1 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Match2 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Match3 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Match4 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Winner1 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Winner2 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Winner3 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">QF_Winner4 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">SF_Match1 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">SF_Match2 =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">SF1_Winner =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">SF2_Winner =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Finals_Hi =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Finals_Lo =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims),</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Champion =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_sims)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">321</span> <span class="sc">+</span> r)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># qf</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  qf_winners <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(possible_matchups))</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(possible_matchups)) {</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">=</span> <span class="fu">simulate_two_leg_goals</span>(</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">ability_hi =</span> possible_matchups<span class="sc">$</span>Hi_ability[i],</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">ability_lo =</span> possible_matchups<span class="sc">$</span>Lo_ability[i],</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_goals =</span> <span class="fl">3.205357</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    qf_winners[i] <span class="ot">=</span> <span class="fu">ifelse</span>(result <span class="sc">==</span> <span class="dv">1</span>, possible_matchups<span class="sc">$</span>Hi[i], possible_matchups<span class="sc">$</span>Lo[i])</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store QF matchups</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    alt_results[r, <span class="fu">paste0</span>(<span class="st">"QF_Match"</span>, i)] <span class="ot">=</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(possible_matchups<span class="sc">$</span>Hi[i], <span class="st">"vs"</span>, possible_matchups<span class="sc">$</span>Lo[i])</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    alt_results[r, <span class="fu">paste0</span>(<span class="st">"QF_Winner"</span>, i)] <span class="ot">=</span> qf_winners[i]</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sf</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>  semis <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hi =</span> <span class="fu">c</span>(qf_winners[<span class="dv">1</span>], qf_winners[<span class="dv">3</span>]),</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lo =</span> <span class="fu">c</span>(qf_winners[<span class="dv">2</span>], qf_winners[<span class="dv">4</span>])</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(combined_lambda_hat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(team, ability),</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Hi"</span> <span class="ot">=</span> <span class="st">"team"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Hi_ability =</span> ability) <span class="sc">%&gt;%</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(combined_lambda_hat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(team, ability),</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Lo"</span> <span class="ot">=</span> <span class="st">"team"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Lo_ability =</span> ability)</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>  sf_winners <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(semis))</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(semis)) {</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">=</span> <span class="fu">simulate_two_leg_goals</span>(</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">ability_hi =</span> semis<span class="sc">$</span>Hi_ability[i],</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">ability_lo =</span> semis<span class="sc">$</span>Lo_ability[i],</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_goals =</span> <span class="fl">3.205357</span></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>    sf_winners[i] <span class="ot">=</span> <span class="fu">ifelse</span>(result <span class="sc">==</span> <span class="dv">1</span>, semis<span class="sc">$</span>Hi[i], semis<span class="sc">$</span>Lo[i])</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store SF matchups</span></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>    alt_results[r, <span class="fu">paste0</span>(<span class="st">"SF_Match"</span>, i)] <span class="ot">=</span></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(semis<span class="sc">$</span>Hi[i], <span class="st">"vs"</span>, semis<span class="sc">$</span>Lo[i])</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>  alt_results[r, <span class="fu">c</span>(<span class="st">"SF1_Winner"</span>, <span class="st">"SF2_Winner"</span>)] <span class="ot">=</span> sf_winners</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># finals</span></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>  finals <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">Team1 =</span> sf_winners[<span class="dv">1</span>],</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">Team2 =</span> sf_winners[<span class="dv">2</span>]</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>      combined_lambda_hat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Team1 =</span> team, <span class="at">Team1_Ability =</span> ability),</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"Team1"</span></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>      combined_lambda_hat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Team2 =</span> team, <span class="at">Team2_Ability =</span> ability),</span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"Team2"</span></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Hi =</span> <span class="fu">ifelse</span>(Team1_Ability <span class="sc">&gt;</span> Team2_Ability, Team1, Team2),</span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Lo =</span> <span class="fu">ifelse</span>(Team1_Ability <span class="sc">&gt;</span> Team2_Ability, Team2, Team1),</span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Hi_ability =</span> <span class="fu">pmax</span>(Team1_Ability, Team2_Ability),</span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Lo_ability =</span> <span class="fu">pmin</span>(Team1_Ability, Team2_Ability),</span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">prob =</span> <span class="fu">exp</span>(Hi_ability) <span class="sc">/</span> (<span class="fu">exp</span>(Hi_ability) <span class="sc">+</span> <span class="fu">exp</span>(Lo_ability))</span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Hi, Lo, prob)</span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a>  alt_results[r, <span class="st">"Finals_Hi"</span>] <span class="ot">=</span> finals<span class="sc">$</span>Hi[<span class="dv">1</span>]</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>  alt_results[r, <span class="st">"Finals_Lo"</span>] <span class="ot">=</span> finals<span class="sc">$</span>Lo[<span class="dv">1</span>]</span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate one-leg final</span></span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>  final_outcome <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, finals<span class="sc">$</span>prob[<span class="dv">1</span>])</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>  alt_results[r, <span class="st">"Champion"</span>] <span class="ot">=</span></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(final_outcome <span class="sc">==</span> <span class="dv">1</span>, finals<span class="sc">$</span>Hi[<span class="dv">1</span>], finals<span class="sc">$</span>Lo[<span class="dv">1</span>])</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a><span class="co"># results</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>champions <span class="ot">=</span> alt_results <span class="sc">%&gt;%</span></span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(Champion, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Prob =</span> n <span class="sc">/</span> n_sims)</span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>champions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         Champion    n   Prob
1       Paris S-G 4862 0.4862
2       Barcelona 3468 0.3468
3 Manchester City  827 0.0827
4 Atlético Madrid  451 0.0451
5            Lyon  206 0.0206
6   Bayern Munich  147 0.0147
7        Atalanta   24 0.0024
8      RB Leipzig   15 0.0015</code></pre>
</div>
</div>
<p>After simulating 10,000 times, we see results that are in line with the Bradley-Terry latent strengths we derived earlier. Primarily, PSG (which had the strongest ability) won 48.6% of the simulation’s runs, while Barcelona and Manchester City were the 2nd and 3rd most common winners. We see actual winners, Bayern Munich, in the 6th likeliest position to win, suggesting either our results are faulty, or real results deviated strongly from our expectation.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This trend also appears in the predicted semifinal and final match-ups, with neither of the two likeliest semifinal match-ups being the correct prediction based on the actual tournament, nor the actual final appearing in the top 4 likeliest.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Simulation to determine most likely winners of 2019-2020 UCL with Bradley-Terry strengths</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>final_matchups <span class="ot">=</span> alt_results <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Final_Pair =</span> <span class="fu">paste</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pmin</span>(Finals_Hi, Finals_Lo),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pmax</span>(Finals_Hi, Finals_Lo),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">" vs "</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Final_Pair, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Prob =</span> n <span class="sc">/</span> n_sims)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">=</span> final_matchups <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Final_Pair, Prob), <span class="at">y =</span> Prob)) <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#e31a1c"</span>) <span class="sc">+</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(Prob, <span class="at">accuracy =</span> <span class="fl">0.1</span>)),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(final_matchups<span class="sc">$</span>Prob) <span class="sc">*</span> <span class="fl">1.15</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Most Common Final Matchups (10,000 Runs)"</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"2019–20 UEFA Champions League Simulation (Bradley–Terry + Poisson)"</span>,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Final Matchup"</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>final_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<style type="text/css">
.standings {
  font-family: "JetBrains Mono", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 1em;
}

.team {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 0.75rem;
}

.team-flag {
  height: 2.5rem;
  margin-right: 0.25rem;
}

.title h3 {
  font-weight: 400;
}
</style>
</div>
<div class="cell">
<div class="cell-output-display">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&amp;display=swap" rel="stylesheet">
</div>
</div>
</section>
</section>
<section id="introducing-covariates" class="level2">
<h2 class="anchored" data-anchor-id="introducing-covariates">Introducing Covariates</h2>
<section id="fitting-bradley-terry-with-domestic-strength-covariate" class="level3">
<h3 class="anchored" data-anchor-id="fitting-bradley-terry-with-domestic-strength-covariate">Fitting Bradley-Terry with Domestic Strength Covariate</h3>
<p>Now, we’ll move on from the traditional Bradley-Terry fitting process to fitting our strengths with covariates.</p>
<p>To begin, we’ll normalize our derived domestic strengths for each team so that our model can better fit coefficients to the data, and prepare a data frame such that our Bradley-Terry model can be fit using these domestic strengths. Ideally, we’ll use these strengths to define the probability, <span class="math display">\[
\mathbb{P}(\text{team i with domestic strength x beats team j with domestic strength y}) = \frac{1}{1+e^{-1\times(((\lambda_i+x\lambda_0))-(\lambda_j+y\lambda_0))}}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize strengths</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>domestic_strength<span class="sc">$</span>ability <span class="ot">=</span> (domestic_strength<span class="sc">$</span>ability<span class="sc">-</span><span class="fu">mean</span>(domestic_strength<span class="sc">$</span>ability))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">var</span>(domestic_strength<span class="sc">$</span>ability))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>domestic_strength</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 4
   Home          Country ability     s.e.
   &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 Slavia Prague cz       4.98   1455.   
 2 Red Star      rs       1.04      1.37 
 3 Olympiacos    gr       0.982     1.29 
 4 Dinamo Zagreb hr       0.261     0.932
 5 Liverpool     eng      0.253     1.12 
 6 Shakhtar      ua       0.247     1.15 
 7 Benfica       pt       0.194     0.833
 8 Paris S-G     fr       0.0252    0.680
 9 Ajax          nl       0.0147    0.706
10 Barcelona     es       0.0108    0.753
# ℹ 22 more rows</code></pre>
</div>
</div>
<p>With our strengths now together, we’ll do an initial fit of the Bradley-Terry model, and use the coefficient of <code>domestic.strength</code> for <span class="math inline">\(\lambda_0\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  BradleyTerry2<span class="sc">::</span><span class="fu">BTm</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">cbind</span>(home.win, away.win),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">player1 =</span> home.team, <span class="at">player2 =</span> away.team,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="sc">~</span> team <span class="sc">+</span> domestic.strength,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">refcat =</span> <span class="st">"Dinamo Zagreb"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"team"</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">separate.ability =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tmp)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           teamAjax        teamAtalanta teamAtlético Madrid       teamBarcelona 
         1.91093230         -4.10757784          4.95066600         18.32958833 
  teamBayern Munich         teamBenfica         teamChelsea     teamClub Brugge 
        22.28206432          5.44814350         -0.44969513        -18.70819436 
       teamDortmund     teamGalatasaray            teamGenk           teamInter 
        -4.38467893        -19.85040829        -20.23717119         -5.05859911 
       teamJuventus      teamLeverkusen           teamLille       teamLiverpool 
        26.93327005          1.53171789        -20.53087530         22.57980919 
    teamLoko Moscow            teamLyon teamManchester City          teamNapoli 
                 NA          3.26622059         19.68974470         38.90603915 
     teamOlympiacos       teamParis S-G      teamRB Leipzig     teamRB Salzburg 
       -11.15999392         22.23026883          2.93535866                  NA 
    teamReal Madrid        teamRed Star        teamShakhtar   teamSlavia Prague 
                 NA        -10.84192473         -0.08239455                  NA 
      teamTottenham        teamValencia           teamZenit   domestic.strength 
                 NA                  NA                  NA         -5.26800595 </code></pre>
</div>
</div>
<p>Above, we see a significant issue: team strengths with the value <code>NA</code>. This likely arises due to the “disconnected” nature of the group stage data, or the nature that teams do not play other teams outside of their group. Therefore, to determine a strength for each team, we’ll take a sample of reference teams, fit the Bradley-Terry model to each, and take the mean of each team’s strength.</p>
<div class="cell">
<details class="code-fold">
<summary>Helper to run multiple Bradley-Terry fits with random sample of reference teams</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>run_mult_fits <span class="ot">=</span> <span class="cf">function</span>(num_fits, <span class="at">with_replacement =</span> <span class="cn">FALSE</span>, <span class="at">full=</span><span class="cn">FALSE</span>){</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">439</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  champs <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">'../data/raw/UEFA_Champions_League_2020_Results_RAW.csv'</span>, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  no_ties <span class="ot">=</span> champs <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Competition_Name'</span>,<span class="st">'Gender'</span>,<span class="st">'Country'</span>, <span class="st">'Season_End_Year'</span>, <span class="st">'Wk'</span>, <span class="st">'Date'</span>, <span class="st">'Day'</span>,<span class="st">'Time'</span>, <span class="st">'Home_xG'</span>, <span class="st">'Away_xG'</span>, <span class="st">'Attendance'</span>, <span class="st">'Referee'</span>, <span class="st">'Notes'</span>,<span class="st">'Venue'</span>, <span class="st">'MatchURL'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(HomeGoals <span class="sc">!=</span> AwayGoals <span class="sc">&amp;</span> Round <span class="sc">==</span> <span class="st">'Group stage'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Round'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Home =</span> <span class="fu">str_replace</span>(Home, <span class="st">' [a-z]{2,3}$'</span>, <span class="st">''</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">Away =</span> <span class="fu">str_replace</span>(Away, <span class="st">'^[a-z]{2,3} '</span>, <span class="st">''</span>),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">Home_Winner =</span> <span class="fu">case_when</span>(HomeGoals <span class="sc">&gt;</span> AwayGoals <span class="sc">~</span> <span class="dv">1</span>, <span class="at">.default=</span><span class="dv">0</span>),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">Opp_Winner =</span> <span class="fu">case_when</span>(AwayGoals <span class="sc">&gt;</span> HomeGoals <span class="sc">~</span> <span class="dv">1</span>, <span class="at">.default=</span><span class="dv">0</span>))</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  unik_teams <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(no_ties<span class="sc">$</span>Home, no_ties<span class="sc">$</span>Away)))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    BradleyTerry2<span class="sc">::</span><span class="fu">BTm</span>(</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">outcome =</span> <span class="fu">cbind</span>(home.win, away.win),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">player1 =</span> home.team, <span class="at">player2 =</span> away.team,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> <span class="sc">~</span> team <span class="sc">+</span> domestic.strength,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">refcat =</span> <span class="st">'Ajax'</span>,</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> <span class="st">"team"</span>,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">separate.ability =</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> tmp)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">=</span> <span class="fu">transpose</span>(<span class="fu">data.table</span>(unik_teams))</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(coefs) <span class="ot">=</span> <span class="fu">coef</span>(fit) <span class="sc">%&gt;%</span> names</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  coefs[<span class="dv">1</span>,] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>num_fits){</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    zero_row <span class="ot">=</span> <span class="fu">transpose</span>(<span class="fu">data.table</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(<span class="fu">colnames</span>(coefs)))))</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(zero_row) <span class="ot">=</span> <span class="fu">coef</span>(fit) <span class="sc">%&gt;%</span> names</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">=</span> coefs <span class="sc">%&gt;%</span> <span class="fu">rbind</span>(zero_row)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  coefs<span class="sc">$</span>Ref <span class="ot">=</span> <span class="fu">sample</span>(unik_teams,<span class="at">size=</span>num_fits,<span class="at">replace=</span>with_replacement)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">=</span> <span class="fu">transpose</span>(<span class="fu">data.frame</span>(<span class="fu">coef</span>(fit)))</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(c) <span class="ot">=</span> <span class="fu">coef</span>(fit) <span class="sc">%&gt;%</span> names</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">=</span> coefs <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="fu">colnames</span>(c), <span class="fu">str_c</span>(),<span class="st">'Ref'</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'domestic.strength'</span>))</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  ref_cat <span class="ot">=</span> <span class="fu">str_c</span>(<span class="st">'team'</span>,coefs[<span class="dv">1</span>,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Ref))</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>  c[<span class="dv">1</span>,<span class="st">'Ref'</span>] <span class="ot">=</span> coefs[<span class="dv">1</span>,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Ref)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>  coefs[<span class="dv">1</span>,] <span class="ot">=</span> c[<span class="dv">1</span>,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'domestic.strength'</span>))</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>  coefs[<span class="dv">1</span>,ref_cat] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">=</span> coefs <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">sort</span>(<span class="fu">colnames</span>(coefs)))</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>num_fits){</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>({</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>      fit <span class="ot">&lt;-</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>      BradleyTerry2<span class="sc">::</span><span class="fu">BTm</span>(</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome =</span> <span class="fu">cbind</span>(home.win, away.win),</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">player1 =</span> home.team, <span class="at">player2 =</span> away.team,</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> <span class="sc">~</span> team <span class="sc">+</span> domestic.strength,</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">refcat =</span> coefs[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Ref),</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> <span class="st">"team"</span>,</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">separate.ability =</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> tmp)</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>    c <span class="ot">=</span> <span class="fu">transpose</span>(<span class="fu">data.frame</span>(<span class="fu">coef</span>(fit)))</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(c) <span class="ot">=</span> <span class="fu">coef</span>(fit) <span class="sc">%&gt;%</span> names</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>    ref_cat <span class="ot">=</span> <span class="fu">str_c</span>(<span class="st">'team'</span>,coefs[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Ref))</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>    c[<span class="dv">1</span>,<span class="st">'Ref'</span>] <span class="ot">=</span> coefs[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Ref)</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>    c <span class="ot">=</span> c <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'domestic.strength'</span>))</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>    c[<span class="dv">1</span>,ref_cat] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>    c <span class="ot">=</span> c <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">colnames</span>(coefs))</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>    coefs[i,] <span class="ot">=</span> c[<span class="dv">1</span>,]</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>  coefs[<span class="fu">is.na</span>(coefs)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>  teams <span class="ot">=</span> coefs <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Ref'</span>)) <span class="sc">%&gt;%</span> names</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>  adjusted_coefs <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(teams)){</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>    team <span class="ot">=</span> <span class="fu">as.numeric</span>(coefs <span class="sc">%&gt;%</span> <span class="fu">pull</span>(teams[i]))</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>    team <span class="ot">=</span> team[team <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>    adjusted_coef <span class="ot">=</span> <span class="fu">sum</span>(team)<span class="sc">/</span><span class="fu">length</span>(team)</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>    adjusted_coefs[<span class="fu">length</span>(adjusted_coefs) <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">=</span> adjusted_coef</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>  adjusted <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">team =</span> teams <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(<span class="st">'team'</span>, <span class="st">''</span>), <span class="at">ability =</span> adjusted_coefs)</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(full){</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(coefs, adjusted))</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(adjusted)</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="standings">
<div class="title">
<h3 class="anchored">Normalized Team Strengths for Quarterfinal Participants</h3>
<h4 class="anchored">Latent team strengths found and normalized after fitting Bradley-Terry model with domestic strength covariate</h4>
</div>
<div class="reactable html-widget html-fill-item" id="htmlwidget-4e2dca20088ac537b0ca" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4e2dca20088ac537b0ca">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".rownames":["Paris S-G","Bayern Munich","Manchester City","Barcelona","Atlético Madrid","Lyon","RB Leipzig","Atalanta"],"ability":[1.4467418824857,1.40197490117146,1.23643179327883,1.15352833626561,0.280847848983335,0.154836585632791,0.133148923398285,-0.336273345916932]},"columns":[{"id":".rownames","name":"","type":"character","vAlign":"center","headerVAlign":"bottom","className":"cell","headerClassName":"header","sortable":false,"filterable":false,"rowHeader":true},{"id":"ability","name":"Team Strength","type":"numeric","vAlign":"center","headerVAlign":"bottom","className":"cell number ","headerClassName":"header","cell":["1.45","1.4","1.24","1.15","0.28","0.15","0.13","-0.34"],"maxWidth":150,"style":[{"color":"#111","background":"#35B0AB"},{"color":"#111","background":"#3BB2AB"},{"color":"#111","background":"#54BBAB"},{"color":"#111","background":"#60C0AB"},{"color":"#111","background":"#D5F0BC"},{"color":"#111","background":"#E8F7CA"},{"color":"#111","background":"#EBF8CD"},{"color":"#aaa"}]}],"defaultSortDesc":true,"defaultSorted":[{"id":"ability","desc":true}],"pagination":false,"borderless":true,"showSortIcon":false,"className":"standings-table","dataKey":"4543fe1821a0ab46e015529aec897d8c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<p>With our team strengths in place, we can now begin computing the probabilities for each potential match-up that occurs in the quarterfinal through the final round, based on the formula described above.</p>
<div class="cell">
<details class="code-fold">
<summary>Computing pairwise probabilities for possible matchups with covariate for domestic strength</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>({</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  possible_matchups <span class="ot">=</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand.grid</span>(<span class="at">team1 =</span> <span class="fu">rownames</span>(uefa_playoff_team_strengths), <span class="at">team2 =</span> <span class="fu">rownames</span>(uefa_playoff_team_strengths)) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(team1 <span class="sc">!=</span> team2) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">team1_strength =</span> uefa_playoff_team_strengths[team1, <span class="st">"ability"</span>], <span class="at">team2_strength =</span> uefa_playoff_team_strengths[team2, <span class="st">"ability"</span>])</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  possible_matchups <span class="ot">=</span> possible_matchups <span class="sc">%&gt;%</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(domestic_strength <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">team1 =</span> Home)) <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Country'</span>,<span class="st">'s.e.'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">team1_domestic =</span> ability)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  possible_matchups <span class="ot">=</span> possible_matchups <span class="sc">%&gt;%</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(domestic_strength <span class="sc">%&gt;%</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">team2 =</span> Home)) <span class="sc">%&gt;%</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Country'</span>,<span class="st">'s.e.'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">team2_domestic =</span> ability)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  possible_matchups <span class="ot">=</span> possible_matchups <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>((team1_strength<span class="sc">+</span>(team1_domestic<span class="sc">*</span>lambda0_hat))<span class="sc">-</span>(team2_strength<span class="sc">+</span>(team2_domestic<span class="sc">*</span>lambda0_hat)))))</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>possible_matchups <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'team1'</span>,<span class="st">'team2'</span>,<span class="st">'prob'</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             team1           team2      prob
1  Atlético Madrid        Atalanta 0.6346798
2        Barcelona        Atalanta 0.7907604
3    Bayern Munich        Atalanta 0.8422768
4             Lyon        Atalanta 0.6036359
5  Manchester City        Atalanta 0.8120829
6        Paris S-G        Atalanta 0.8344525
7       RB Leipzig        Atalanta 0.6194135
8         Atalanta Atlético Madrid 0.3653202
9        Barcelona Atlético Madrid 0.6850696
10   Bayern Munich Atlético Madrid 0.7545301</code></pre>
</div>
</div>
<p>Since each round but the final takes place over two games, the chance of seeing the teams split the two games is high. Therefore, we need a way to choose a winner based on some other source of information. Thankfully, we have access to goal scoring data from the group stage, which we can use to make an informed estimation of the tie-breaking criteria that is used in this case in the actual UCL tournament: goal aggregate. For this, we’ll take the mean of the goals scored for each team throughout the group stage and use it as the parameter for a Poisson distribution. Poisson distributions have long been used for simulating goals scored for a particular team, often utilizing the same methodology to choose the value of <span class="math inline">\(\lambda\)</span> <span class="citation" data-cites="poisson">(<a href="#ref-poisson" role="doc-biblioref">2010</a>)</span>.</p>
<p>In other words, in the event of a tie between the two legs, we’ll choose a goal value based on the following distribution:<br>
<span class="math display">\[\lambda_i = \text{mean goals for team i in group stage}; \text{Draw from Pois}(\lambda_i)=\text{team i goals}\]</span></p>
<p>The helper function below will run a single iteration of our simulation:</p>
<div class="cell">
<details class="code-fold">
<summary>Helper function to run a single iteration of UCL tournament from quarterfinal to final with Bradley-Terry model fitted with domestic strength covariate</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>run_iteration <span class="ot">=</span> <span class="cf">function</span>(<span class="at">seed=</span><span class="dv">439</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>){</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  knockout <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">round =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'Quarter'</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'Semi'</span>, <span class="dv">2</span>)), <span class="st">'Final'</span>), <span class="at">team1 =</span> <span class="fu">rep</span>(<span class="st">''</span>,<span class="dv">7</span>), <span class="at">team2 =</span> <span class="fu">rep</span>(<span class="st">''</span>,<span class="dv">7</span>), <span class="at">winner =</span> <span class="fu">rep</span>(<span class="st">''</span>,<span class="dv">7</span>))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">1</span>,<span class="st">'team1'</span>] <span class="ot">=</span> <span class="st">'RB Leipzig'</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">1</span>,<span class="st">'team2'</span>] <span class="ot">=</span> <span class="st">'Atlético Madrid'</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">2</span>,<span class="st">'team1'</span>] <span class="ot">=</span> <span class="st">'Atalanta'</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">2</span>,<span class="st">'team2'</span>] <span class="ot">=</span> <span class="st">'Paris S-G'</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">3</span>,<span class="st">'team1'</span>] <span class="ot">=</span> <span class="st">'Manchester City'</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">3</span>,<span class="st">'team2'</span>] <span class="ot">=</span> <span class="st">'Lyon'</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">4</span>,<span class="st">'team1'</span>] <span class="ot">=</span> <span class="st">'Barcelona'</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">4</span>,<span class="st">'team2'</span>] <span class="ot">=</span> <span class="st">'Bayern Munich'</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  quarters <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    team_a <span class="ot">=</span> knockout[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'team1'</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    team_b <span class="ot">=</span> knockout[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'team2'</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    prob_team1 <span class="ot">=</span> possible_matchups <span class="sc">%&gt;%</span> <span class="fu">filter</span>(team1 <span class="sc">==</span> team_a <span class="sc">&amp;</span> team2 <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'prob'</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(verbose){</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">"Quarter "</span>,i,<span class="st">" Probability that team 1 "</span>, team_a, <span class="st">" beats team 2 "</span>, team_b, <span class="st">" :"</span>, prob_team1))</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>prob_team1)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results[<span class="dv">1</span>] <span class="sc">!=</span> results[<span class="dv">2</span>]){</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(verbose){</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">str_c</span>(team_a, <span class="st">" and "</span>, team_b, <span class="st">" split series. Using tie breaker..."</span>))</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>      mean_team1 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_a <span class="sc">|</span> Away <span class="sc">==</span> team_a) <span class="sc">%&gt;%</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_a <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_a <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>()</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>      mean_team2 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_b <span class="sc">|</span> Away <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_b <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_b <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>()</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>      <span class="do">## choose winner</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>      team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>      team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span>(team1_goals <span class="sc">==</span> team2_goals){</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>        team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>        team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(verbose){</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">str_c</span>(team_a, <span class="st">" scored "</span>, team1_goals))</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">str_c</span>(team_b, <span class="st">" scored "</span>, team2_goals))</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(team1_goals <span class="sc">&gt;</span> team2_goals){</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>        winner <span class="ot">=</span> team_a</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>        winner <span class="ot">=</span> team_b</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">as.numeric</span>(results)) <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>      winner <span class="ot">=</span> team_a</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>      winner <span class="ot">=</span> team_b</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    quarters[<span class="fu">length</span>(quarters)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> winner</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),<span class="st">'winner'</span>]<span class="ot">=</span> quarters</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">5</span>,<span class="fu">c</span>(<span class="st">'team1'</span>, <span class="st">'team2'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(quarters[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">6</span>,<span class="fu">c</span>(<span class="st">'team1'</span>, <span class="st">'team2'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(quarters[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)])</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>  semis <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>){</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>    team_a <span class="ot">=</span> knockout[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'team1'</span>)</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>    team_b <span class="ot">=</span> knockout[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'team2'</span>)</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>    prob_team1 <span class="ot">=</span> possible_matchups <span class="sc">%&gt;%</span> <span class="fu">filter</span>(team1 <span class="sc">==</span> team_a <span class="sc">&amp;</span> team2 <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'prob'</span>)</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(verbose){</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">"Semi "</span>,i<span class="dv">-4</span>,<span class="st">" Probability that team 1 "</span>, team_a, <span class="st">" beats team 2 "</span>, team_b, <span class="st">" :"</span>, prob_team1))</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>prob_team1)</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results[<span class="dv">1</span>] <span class="sc">!=</span> results[<span class="dv">2</span>]){</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(verbose){</span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">str_c</span>(team_a, <span class="st">" and "</span>, team_b, <span class="st">" split series. Using tie breaker..."</span>))</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>      mean_team1 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_a <span class="sc">|</span> Away <span class="sc">==</span> team_a) <span class="sc">%&gt;%</span></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_a <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_a <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>()</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>      mean_team2 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_b <span class="sc">|</span> Away <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_b <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_b <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span></span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>()</span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>      <span class="do">## choose winner</span></span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>      team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>      team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span>(team1_goals <span class="sc">==</span> team2_goals){</span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a>        team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a>        team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(verbose){</span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">str_c</span>(team_a, <span class="st">" scored "</span>, team1_goals))</span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">str_c</span>(team_b, <span class="st">" scored "</span>, team2_goals))</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(team1_goals <span class="sc">&gt;</span> team2_goals){</span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a>        winner <span class="ot">=</span> team_a</span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a>        winner <span class="ot">=</span> team_b</span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">as.numeric</span>(results)) <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a>      winner <span class="ot">=</span> team_a</span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a>      winner <span class="ot">=</span> team_b</span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a>    semis[<span class="fu">length</span>(semis)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> winner</span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>),<span class="st">'winner'</span>]<span class="ot">=</span> semis</span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">7</span>,<span class="fu">c</span>(<span class="st">'team1'</span>, <span class="st">'team2'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(semis[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> <span class="dv">7</span></span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a>  team_a <span class="ot">=</span> knockout[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'team1'</span>)</span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a>  team_b <span class="ot">=</span> knockout[i,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'team2'</span>)</span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a>  prob_team1 <span class="ot">=</span> possible_matchups <span class="sc">%&gt;%</span> <span class="fu">filter</span>(team1 <span class="sc">==</span> team_a <span class="sc">&amp;</span> team_b <span class="sc">==</span> team2) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'prob'</span>)</span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(verbose){</span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">"Final: Probability that team 1 "</span>, team_a, <span class="st">" beats team 2 "</span>, team_b, <span class="st">" :"</span>, prob_team1))</span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>prob_team1)</span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(result <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a>    winner <span class="ot">=</span> team_a</span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a>    winner <span class="ot">=</span> team_b</span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(verbose){</span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">str_c</span>(winner, <span class="st">" WINS"</span>))</span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">7</span>,<span class="st">'winner'</span>] <span class="ot">=</span> winner</span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(knockout)</span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We’ll run one simulation to get an idea of how the results are structured and use the <code>verbose</code> option to get a read of the simulation’s stages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of simulation when run verbose</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">run_iteration</span>(<span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Quarter 1 Probability that team 1 RB Leipzig beats team 2 Atlético Madrid :0.483684134254207"
[1] "Quarter 2 Probability that team 1 Atalanta beats team 2 Paris S-G :0.165547545542045"
[1] "Atalanta and Paris S-G split series. Using tie breaker..."
[1] "Atalanta scored 1"
[1] "Paris S-G scored 6"
[1] "Quarter 3 Probability that team 1 Manchester City beats team 2 Lyon :0.739421494641044"
[1] "Manchester City and Lyon split series. Using tie breaker..."
[1] "Manchester City scored 3"
[1] "Lyon scored 2"
[1] "Quarter 4 Probability that team 1 Barcelona beats team 2 Bayern Munich :0.414412830117671"
[1] "Barcelona and Bayern Munich split series. Using tie breaker..."
[1] "Barcelona scored 2"
[1] "Bayern Munich scored 3"
[1] "Semi 1 Probability that team 1 RB Leipzig beats team 2 Paris S-G :0.244076636223594"
[1] "Semi 2 Probability that team 1 Manchester City beats team 2 Bayern Munich :0.447280277786489"
[1] "Final: Probability that team 1 Paris S-G beats team 2 Manchester City :0.538403123209533"
[1] "Paris S-G WINS"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  round   team1           team2           winner         
  &lt;chr&gt;   &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;          
1 Quarter RB Leipzig      Atlético Madrid RB Leipzig     
2 Quarter Atalanta        Paris S-G       Paris S-G      
3 Quarter Manchester City Lyon            Manchester City
4 Quarter Barcelona       Bayern Munich   Bayern Munich  
5 Semi    RB Leipzig      Paris S-G       Paris S-G      
6 Semi    Manchester City Bayern Munich   Manchester City
7 Final   Paris S-G       Manchester City Paris S-G      </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   winner [3]
  winner              n
  &lt;chr&gt;           &lt;int&gt;
1 Bayern Munich       2
2 Manchester City     2
3 Paris S-G           6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medium-sized number of iterations</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">=</span> <span class="fu">run_n_iterations</span>(<span class="dv">1000</span>, <span class="at">seed=</span><span class="dv">12</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'Final'</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(winner) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
# Groups:   winner [8]
  winner              n
  &lt;chr&gt;           &lt;int&gt;
1 Atalanta            8
2 Atlético Madrid    28
3 Barcelona          43
4 Bayern Munich     314
5 Lyon                6
6 Manchester City   157
7 Paris S-G         418
8 RB Leipzig         26</code></pre>
</div>
</div>
<p>After getting an idea of what type of results we should see, let’s run the simulation 10,000 times to get an idea of how we would expect the tournament to play out given our conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">=</span> <span class="fu">run_n_iterations</span>(<span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
# Groups:   winner [8]
  winner              n   prob
  &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
1 Paris S-G        4040 0.404 
2 Bayern Munich    3160 0.316 
3 Manchester City  1754 0.175 
4 Barcelona         451 0.0451
5 Atlético Madrid   243 0.0243
6 RB Leipzig        240 0.024 
7 Lyon               58 0.0058
8 Atalanta           54 0.0054</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
# Groups:   team1, team2 [16]
   team1           team2               n   prob
   &lt;chr&gt;           &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
 1 Paris S-G       Bayern Munich    4311 0.431 
 2 Paris S-G       Manchester City  2682 0.268 
 3 Paris S-G       Barcelona         696 0.0696
 4 RB Leipzig      Bayern Munich     545 0.0545
 5 Atlético Madrid Bayern Munich     433 0.0433
 6 RB Leipzig      Manchester City   354 0.0354
 7 Atlético Madrid Manchester City   331 0.0331
 8 Paris S-G       Lyon              169 0.0169
 9 Atalanta        Bayern Munich     159 0.0159
10 Atalanta        Manchester City    85 0.0085
11 RB Leipzig      Barcelona          80 0.008 
12 Atlético Madrid Barcelona          79 0.0079
13 RB Leipzig      Lyon               26 0.0026
14 Atalanta        Barcelona          25 0.0025
15 Atlético Madrid Lyon               18 0.0018
16 Atalanta        Lyon                7 0.0007</code></pre>
</div>
</div>
<p>From the two tables above, we see both results that align with the real outcome of the tournament (PSG vs.&nbsp;Bayern) along with results that diverge from history (PSG winning the tournament). Overall, although the predicted winner, PSG, didn’t win in real life, our results do roughly align with the match-ups and outcomes seen throughout the actual tournament. For instance, let’s view the most common semifinal match-ups:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
# Groups:   team1, team2 [8]
  team1           team2             n   prob
  &lt;chr&gt;           &lt;chr&gt;         &lt;int&gt;  &lt;dbl&gt;
1 Manchester City Bayern Munich  6597 0.330 
2 RB Leipzig      Paris S-G      4911 0.246 
3 Atlético Madrid Paris S-G      4297 0.215 
4 Manchester City Barcelona      1817 0.0908
5 Lyon            Bayern Munich  1233 0.0616
6 Atlético Madrid Atalanta        396 0.0198
7 RB Leipzig      Atalanta        396 0.0198
8 Lyon            Barcelona       353 0.0176</code></pre>
</div>
</div>
<p>The top two results, Manchester City vs.&nbsp;Bayern Munich and RB Leipzig vs.&nbsp;PSG were the two actual semifinal match-ups in the 2019-2020 tournament.</p>
</section>
</section>
<section id="integrating-home-field-advantage" class="level2">
<h2 class="anchored" data-anchor-id="integrating-home-field-advantage">Integrating Home Field Advantage</h2>
<p>We can refine the model above by also taking into account the advantage derived from playing at home throughout the group stage. From this, we’ll define the probability that team <em>i</em> beats team <em>j</em>, given team i and team j’s domestic strengths, and if team i is playing at home. This probability can be expressed as, <span class="math display">\[
\mathbb{P}(\text{team i with domestic strength x beats team j with domestic strength y at i's home}) = \\ \frac{1}{1+e^{-1\times(((\lambda_i+x\lambda_0)+\lambda_1)-(\lambda_j+y\lambda_0))}}
\]</span></p>
<p>Thus, we’ll restructure our results data frame to work with the <code>BradleyTerry2</code> package with the domestic strengths we previously used and an indicator <em>at.home</em> for whether team i was at home or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>unik_teams <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(no_ties<span class="sc">$</span>Home, no_ties<span class="sc">$</span>Away)))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">=</span> no_ties <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(domestic_strength<span class="sc">%&gt;%</span> <span class="fu">select</span>(Home, ability), <span class="at">relationship=</span><span class="st">'many-to-many'</span>, <span class="at">by=</span><span class="st">'Home'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">home.domestic =</span> ability) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(domestic_strength <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Away =</span> Home) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Away, ability), <span class="at">relationship=</span><span class="st">'many-to-many'</span>, <span class="at">by=</span><span class="st">'Away'</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">away.domestic =</span> ability) <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">home.team =</span> Home, <span class="at">away.team =</span> Away) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(home.team, away.team) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">home.win =</span> <span class="fu">sum</span>(Home_Winner),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">away.win =</span> <span class="fu">sum</span>(Opp_Winner),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">home.domestic =</span> <span class="fu">mean</span>(home.domestic),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">away.domestic =</span> <span class="fu">mean</span>(away.domestic), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">home.team =</span> <span class="fu">factor</span>(home.team, <span class="at">levels =</span> unik_teams),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">away.team =</span> <span class="fu">factor</span>(away.team, <span class="at">levels =</span> unik_teams),</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">home.athome =</span> <span class="dv">1</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">away.athome =</span> <span class="dv">0</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">home.win =</span> results<span class="sc">$</span>home.win, <span class="at">away.win =</span> results<span class="sc">$</span>away.win)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>home.team <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">team =</span> results<span class="sc">$</span>home.team,</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">domestic.strength =</span> <span class="fu">scale</span>(results<span class="sc">$</span>home.domestic, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)[,<span class="dv">1</span>],</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">at.home =</span> results<span class="sc">$</span>home.athome</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>away.team <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">team =</span> results<span class="sc">$</span>away.team,</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">domestic.strength =</span> <span class="fu">scale</span>(results<span class="sc">$</span>away.domestic, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)[,<span class="dv">1</span>],</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">at.home =</span> results<span class="sc">$</span>away.athome</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  BradleyTerry2<span class="sc">::</span><span class="fu">BTm</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">cbind</span>(home.win, away.win),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">player1 =</span> home.team, <span class="at">player2 =</span> away.team,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="sc">~</span> team <span class="sc">+</span> domestic.strength <span class="sc">+</span> at.home,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">refcat =</span> <span class="st">"Dinamo Zagreb"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"team"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">separate.ability =</span> <span class="cn">TRUE</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tmp)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           teamAjax        teamAtalanta teamAtlético Madrid       teamBarcelona 
         1.80224040         -4.00115456          4.84067650         19.00311036 
  teamBayern Munich         teamBenfica         teamChelsea     teamClub Brugge 
        22.21687042          5.30166131         -0.46763475        -18.81109085 
       teamDortmund     teamGalatasaray            teamGenk           teamInter 
        -3.67197734        -19.86996347        -20.26420270         -4.32843691 
       teamJuventus      teamLeverkusen           teamLille       teamLiverpool 
        26.78053488          1.49181219        -20.60994065         22.55145912 
    teamLoko Moscow            teamLyon teamManchester City          teamNapoli 
                 NA          3.22317844         19.77098601         38.90278880 
     teamOlympiacos       teamParis S-G      teamRB Leipzig     teamRB Salzburg 
       -11.42893700         22.09694106          2.88882052                  NA 
    teamReal Madrid        teamRed Star        teamShakhtar   teamSlavia Prague 
                 NA        -11.11910867         -0.08025979                  NA 
      teamTottenham        teamValencia           teamZenit   domestic.strength 
                 NA                  NA                  NA         -5.13151713 
            at.home 
         0.06547312 </code></pre>
</div>
</div>
<p>From the above, we see that the raw coefficient given to home pitch advantage is approximately 0.065. However, to remain consistent with the normalization standards we’ve used throughout this section, we’ll normalize this value given the mean and standard deviation of the previous coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>lambda1_hat <span class="ot">=</span> (<span class="fl">0.06547312</span><span class="sc">-</span>mu_ability)<span class="sc">/</span>sd_ability</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>lambda1_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.02459572</code></pre>
</div>
</div>
<p>After this normalization, our home advantage coefficient is negative, suggesting there is a disadvantage to playing at home. While this isn’t intuitive, given a history of literature in this area suggesting otherwise, it is possible that given this small sample, there was enough information to suggest this disadvantage. With that said, this is most likely due to the fact that we are normalizing this coefficient, which isn’t necessarily standard in this form of model fitting. Later, we’ll manually input a <span class="math inline">\(\lambda\)</span> for home advantage to determine if there is enough variation to indicate these results being faulty.</p>
<p>Because we are now factoring in home vs.&nbsp;away in this version of our simulation, we have to track who’s home during which leg. Throughout an actual tournament, in a two-leg round, each team plays one match at home. Thus, we’ve implemented this below, along with using the probability involving the normalized <em>at.home</em> coefficient.</p>
<div class="cell">
<details class="code-fold">
<summary>Helper to run single iteration of UCL tournament from quarterfinals through final with covariates for domestic strength and home field advantage</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>run_iteration_w_home <span class="ot">=</span> <span class="cf">function</span>(<span class="at">seed=</span><span class="dv">439</span>, <span class="at">proba =</span> possible_matchups_w_home){</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  knockout <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">round =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'Quarter'</span>, <span class="dv">8</span>),<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'Semi'</span>, <span class="dv">4</span>)), <span class="st">'Final'</span>), </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">matchup_id =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="fu">rep</span>(<span class="dv">3</span>,<span class="dv">2</span>),<span class="fu">rep</span>(<span class="dv">4</span>,<span class="dv">2</span>),<span class="fu">rep</span>(<span class="dv">5</span>,<span class="dv">2</span>),<span class="fu">rep</span>(<span class="dv">6</span>,<span class="dv">2</span>),<span class="dv">7</span>), </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">leg =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">6</span>), <span class="dv">1</span>),<span class="at">home =</span> <span class="fu">rep</span>(<span class="st">''</span>,<span class="dv">13</span>), <span class="at">away =</span> <span class="fu">rep</span>(<span class="st">''</span>,<span class="dv">13</span>), </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">leg_winner =</span> <span class="fu">rep</span>(<span class="st">''</span>,<span class="dv">13</span>), </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">round_winner =</span> <span class="fu">rep</span>(<span class="st">''</span>, <span class="dv">13</span>))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">1</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'RB Leipzig'</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">1</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'Atlético Madrid'</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">2</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'Atlético Madrid'</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">2</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'RB Leipzig'</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">3</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'Atalanta'</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">3</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'Paris S-G'</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">4</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'Paris S-G'</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">4</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'Atalanta'</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">5</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'Manchester City'</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">5</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'Lyon'</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">6</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'Lyon'</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">6</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'Manchester City'</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">7</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'Barcelona'</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">7</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'Bayern Munich'</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">8</span>,<span class="st">'home'</span>] <span class="ot">=</span> <span class="st">'Bayern Munich'</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">8</span>,<span class="st">'away'</span>] <span class="ot">=</span> <span class="st">'Barcelona'</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  quarters <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(offset <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    index <span class="ot">=</span> i<span class="sc">+</span>((offset<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    team_a <span class="ot">=</span> knockout[index,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'home'</span>)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    team_b <span class="ot">=</span> knockout[index,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'away'</span>)</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    prob_team1 <span class="ot">=</span> proba <span class="sc">%&gt;%</span> <span class="fu">filter</span>(home <span class="sc">==</span> team_a <span class="sc">&amp;</span> away <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'prob'</span>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>prob_team1)</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">as.numeric</span>(results)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>      winner <span class="ot">=</span> team_a</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>      winner <span class="ot">=</span> team_b</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    knockout[index, <span class="st">'leg_winner'</span>] <span class="ot">=</span> winner</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(winner <span class="sc">==</span> knockout[index<span class="dv">-1</span>,]<span class="sc">%&gt;%</span><span class="fu">pull</span>(<span class="st">'leg_winner'</span>)){</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>        knockout[index, <span class="st">'round_winner'</span>] <span class="ot">=</span> winner</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>        quarters[<span class="fu">length</span>(quarters)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> winner</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>        mean_team1 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_a <span class="sc">|</span> Away <span class="sc">==</span> team_a) <span class="sc">%&gt;%</span></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_a <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_a <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean</span>()</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>        mean_team2 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_b <span class="sc">|</span> Away <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span></span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_b <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_b <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean</span>()</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>        <span class="do">## choose winner</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>        team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>        team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span>(team1_goals <span class="sc">==</span> team2_goals){</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>          team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>          team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(team1_goals <span class="sc">&gt;</span> team2_goals){</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>          knockout[index, <span class="st">'round_winner'</span>] <span class="ot">=</span> team_a</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>          quarters[<span class="fu">length</span>(quarters)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> team_a</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>          knockout[index, <span class="st">'round_winner'</span>] <span class="ot">=</span> team_b</span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>          quarters[<span class="fu">length</span>(quarters)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> team_b</span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">9</span>,<span class="fu">c</span>(<span class="st">'home'</span>, <span class="st">'away'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(quarters[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">10</span>,<span class="fu">c</span>(<span class="st">'home'</span>, <span class="st">'away'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(<span class="fu">rev</span>(quarters[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]))</span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">11</span>,<span class="fu">c</span>(<span class="st">'home'</span>, <span class="st">'away'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(quarters[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)])</span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">12</span>,<span class="fu">c</span>(<span class="st">'home'</span>, <span class="st">'away'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(<span class="fu">rev</span>(quarters[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)]))</span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a>  semis <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(offset <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>){</span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>      index <span class="ot">=</span> i<span class="sc">+</span>((offset<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>      team_a <span class="ot">=</span> knockout[index,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'home'</span>)</span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a>      team_b <span class="ot">=</span> knockout[index,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'away'</span>)</span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a>      prob_team1 <span class="ot">=</span> proba <span class="sc">%&gt;%</span> <span class="fu">filter</span>(home <span class="sc">==</span> team_a <span class="sc">&amp;</span> away <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'prob'</span>)</span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a>      results <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>prob_team1)</span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">as.numeric</span>(results)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a>        winner <span class="ot">=</span> team_a</span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>        winner <span class="ot">=</span> team_b</span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a>      knockout[index, <span class="st">'leg_winner'</span>] <span class="ot">=</span> winner</span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(winner <span class="sc">==</span> knockout[index<span class="dv">-1</span>,]<span class="sc">%&gt;%</span><span class="fu">pull</span>(<span class="st">'leg_winner'</span>)){</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a>          knockout[index, <span class="st">'round_winner'</span>] <span class="ot">=</span> winner</span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a>          semis[<span class="fu">length</span>(semis)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> winner</span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a>          mean_team1 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_a <span class="sc">|</span> Away <span class="sc">==</span> team_a) <span class="sc">%&gt;%</span></span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_a <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_a <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>()</span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a>          mean_team2 <span class="ot">=</span> group_stage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Home <span class="sc">==</span> team_b <span class="sc">|</span> Away <span class="sc">==</span> team_b) <span class="sc">%&gt;%</span></span>
<span id="cb56-107"><a href="#cb56-107" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">TotGoals =</span> <span class="fu">case_when</span>(Home <span class="sc">==</span> team_b <span class="sc">~</span> HomeGoals, Away <span class="sc">==</span> team_b <span class="sc">~</span> AwayGoals)) <span class="sc">%&gt;%</span></span>
<span id="cb56-108"><a href="#cb56-108" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(TotGoals) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(TotGoals) <span class="sc">%&gt;%</span></span>
<span id="cb56-109"><a href="#cb56-109" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-110"><a href="#cb56-110" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>()</span>
<span id="cb56-111"><a href="#cb56-111" aria-hidden="true" tabindex="-1"></a>          <span class="do">## choose winner</span></span>
<span id="cb56-112"><a href="#cb56-112" aria-hidden="true" tabindex="-1"></a>          team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb56-113"><a href="#cb56-113" aria-hidden="true" tabindex="-1"></a>          team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb56-114"><a href="#cb56-114" aria-hidden="true" tabindex="-1"></a>          <span class="cf">while</span>(team1_goals <span class="sc">==</span> team2_goals){</span>
<span id="cb56-115"><a href="#cb56-115" aria-hidden="true" tabindex="-1"></a>            team1_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team1)</span>
<span id="cb56-116"><a href="#cb56-116" aria-hidden="true" tabindex="-1"></a>            team2_goals <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">1</span>, mean_team2)</span>
<span id="cb56-117"><a href="#cb56-117" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb56-118"><a href="#cb56-118" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb56-119"><a href="#cb56-119" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(team1_goals <span class="sc">&gt;</span> team2_goals){</span>
<span id="cb56-120"><a href="#cb56-120" aria-hidden="true" tabindex="-1"></a>            knockout[index, <span class="st">'round_winner'</span>] <span class="ot">=</span> team_a</span>
<span id="cb56-121"><a href="#cb56-121" aria-hidden="true" tabindex="-1"></a>            semis[<span class="fu">length</span>(semis)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> team_a</span>
<span id="cb56-122"><a href="#cb56-122" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb56-123"><a href="#cb56-123" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span> {</span>
<span id="cb56-124"><a href="#cb56-124" aria-hidden="true" tabindex="-1"></a>            knockout[index, <span class="st">'round_winner'</span>] <span class="ot">=</span> team_b</span>
<span id="cb56-125"><a href="#cb56-125" aria-hidden="true" tabindex="-1"></a>            semis[<span class="fu">length</span>(semis)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> team_b</span>
<span id="cb56-126"><a href="#cb56-126" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb56-127"><a href="#cb56-127" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-128"><a href="#cb56-128" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-129"><a href="#cb56-129" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-130"><a href="#cb56-130" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-131"><a href="#cb56-131" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">13</span>,<span class="fu">c</span>(<span class="st">'home'</span>, <span class="st">'away'</span>)] <span class="ot">=</span> <span class="fu">as.list</span>(semis[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb56-132"><a href="#cb56-132" aria-hidden="true" tabindex="-1"></a>  team_a <span class="ot">=</span> knockout[<span class="dv">13</span>,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'home'</span>)</span>
<span id="cb56-133"><a href="#cb56-133" aria-hidden="true" tabindex="-1"></a>  team_b <span class="ot">=</span> knockout[<span class="dv">13</span>,] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'away'</span>)</span>
<span id="cb56-134"><a href="#cb56-134" aria-hidden="true" tabindex="-1"></a>  prob_team1 <span class="ot">=</span> possible_matchups <span class="sc">%&gt;%</span> <span class="fu">filter</span>(team1 <span class="sc">==</span> team_a <span class="sc">&amp;</span> team_b <span class="sc">==</span> team2) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">'prob'</span>)</span>
<span id="cb56-135"><a href="#cb56-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-136"><a href="#cb56-136" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>prob_team1)</span>
<span id="cb56-137"><a href="#cb56-137" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(result <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb56-138"><a href="#cb56-138" aria-hidden="true" tabindex="-1"></a>    winner <span class="ot">=</span> team_a</span>
<span id="cb56-139"><a href="#cb56-139" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb56-140"><a href="#cb56-140" aria-hidden="true" tabindex="-1"></a>    winner <span class="ot">=</span> team_b</span>
<span id="cb56-141"><a href="#cb56-141" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-142"><a href="#cb56-142" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">13</span>,<span class="st">'leg_winner'</span>] <span class="ot">=</span> winner</span>
<span id="cb56-143"><a href="#cb56-143" aria-hidden="true" tabindex="-1"></a>  knockout[<span class="dv">13</span>,<span class="st">'round_winner'</span>] <span class="ot">=</span> winner</span>
<span id="cb56-144"><a href="#cb56-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(knockout)</span>
<span id="cb56-145"><a href="#cb56-145" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Again, let’s start small, and get an idea of how our data will turn out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>run_n_iterations_w_home <span class="ot">=</span> <span class="cf">function</span>(n, <span class="at">seed=</span><span class="dv">439</span>){</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  n_iters <span class="ot">=</span> n</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  sims <span class="ot">=</span> <span class="fu">run_iteration_w_home</span>(seed)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_iters){</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    sims <span class="ot">=</span> sims <span class="sc">%&gt;%</span> <span class="fu">rbind</span>(<span class="fu">run_iteration_w_home</span>(<span class="at">seed=</span>seed<span class="sc">*</span>i))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sims)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">=</span> <span class="fu">run_n_iterations_w_home</span>(<span class="dv">10</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'Final'</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(round_winner) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
# Groups:   round_winner [4]
  round_winner        n
  &lt;chr&gt;           &lt;int&gt;
1 Bayern Munich       4
2 Manchester City     2
3 Paris S-G           3
4 RB Leipzig          1</code></pre>
</div>
</div>
<p>As mentioned earlier, we want to be able to modify the <span class="math inline">\(\lambda_1\)</span> value manually. So, we’ll modify the helper to allow us to pass an argument to control this value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>run_n_iterations_w_home <span class="ot">=</span> <span class="cf">function</span>(n, lambda, <span class="at">seed=</span><span class="dv">439</span>){</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  matchups <span class="ot">=</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand.grid</span>(<span class="at">team1 =</span> <span class="fu">rownames</span>(uefa_playoff_team_strengths), <span class="at">team2 =</span> <span class="fu">rownames</span>(uefa_playoff_team_strengths)) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(team1 <span class="sc">!=</span> team2) <span class="sc">%&gt;%</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">team1_strength =</span> uefa_playoff_team_strengths[team1, <span class="st">"ability"</span>], <span class="at">team2_strength =</span> uefa_playoff_team_strengths[team2, <span class="st">"ability"</span>])</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  matchups <span class="ot">=</span> matchups <span class="sc">%&gt;%</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(domestic_strength <span class="sc">%&gt;%</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">team1 =</span> Home), <span class="at">by=</span><span class="st">'team1'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Country'</span>,<span class="st">'s.e.'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">team1_domestic =</span> ability)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  matchups <span class="ot">=</span> matchups <span class="sc">%&gt;%</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(domestic_strength <span class="sc">%&gt;%</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">team2 =</span> Home),  <span class="at">by=</span><span class="st">'team2'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'Country'</span>,<span class="st">'s.e.'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">team2_domestic =</span> ability)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  matchups <span class="ot">=</span> matchups <span class="sc">%&gt;%</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">home =</span> team1, <span class="at">away =</span> team2) <span class="sc">%&gt;%</span> </span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">prob =</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>((team1_strength<span class="sc">+</span>(team1_domestic<span class="sc">*</span>lambda0_hat)<span class="sc">+</span>lambda)<span class="sc">-</span>(team2_strength<span class="sc">+</span>(team2_domestic<span class="sc">*</span>lambda0_hat)))))</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  n_iters <span class="ot">=</span> n</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>  sims <span class="ot">=</span> <span class="fu">run_iteration_w_home</span>(seed)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_iters){</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>    sims <span class="ot">=</span> sims <span class="sc">%&gt;%</span> <span class="fu">rbind</span>(<span class="fu">run_iteration_w_home</span>(<span class="at">seed=</span>seed<span class="sc">*</span>i, <span class="at">proba=</span>matchups))</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sims)</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s compare the results of simulating the knockout stages past the round of 16 with both <span class="math inline">\(\lambda_1*\)</span>, the normalized lambda for home pitch advantage, as well as the original computation for <span class="math inline">\(\lambda_1=0.065\)</span>.</p>
<p><em>Results of using</em> <span class="math inline">\(\lambda_1=-0.0245\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">=</span> <span class="fu">run_n_iterations_w_home</span>(<span class="dv">1000</span>, lambda1_hat)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'Final'</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(round_winner) <span class="sc">%&gt;%</span> <span class="fu">count</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
# Groups:   round_winner [8]
  round_winner        n
  &lt;chr&gt;           &lt;int&gt;
1 Paris S-G         435
2 Bayern Munich     297
3 Manchester City   164
4 Barcelona          54
5 Atlético Madrid    23
6 RB Leipzig         19
7 Lyon                6
8 Atalanta            2</code></pre>
</div>
</div>
<p><em>Results of using</em> <span class="math inline">\(\lambda_1=0.0654\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">=</span> <span class="fu">run_n_iterations_w_home</span>(<span class="dv">1000</span>, <span class="fl">0.06547312</span> )</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>sims <span class="sc">%&gt;%</span> <span class="fu">filter</span>(round <span class="sc">==</span> <span class="st">'Final'</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(round_winner) <span class="sc">%&gt;%</span> <span class="fu">count</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
# Groups:   round_winner [8]
  round_winner        n
  &lt;chr&gt;           &lt;int&gt;
1 Paris S-G         413
2 Bayern Munich     305
3 Manchester City   180
4 Barcelona          46
5 RB Leipzig         25
6 Atlético Madrid    15
7 Lyon                9
8 Atalanta            7</code></pre>
</div>
</div>
<p>A surface-level analysis of the two results suggests that the normalized coefficient doesn’t make much of an impact on the results of the model, with teams like PSG only seeing a change of 4.5% (413 vs.&nbsp;435). Overall, the results do not significantly deviate from the standings computed when just using the domestic strength covariate, with Bayern, Manchester City, and PSG still leading the way.</p>
<p><em>Summary of tournament winners with 10,000 simulations and</em> <span class="math inline">\(\lambda_1=0.06547312\)</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
# Groups:   round_winner [8]
  round_winner        n   prob
  &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
1 Paris S-G        4039 0.404 
2 Bayern Munich    3125 0.312 
3 Manchester City  1818 0.182 
4 Barcelona         457 0.0457
5 RB Leipzig        254 0.0254
6 Atlético Madrid   193 0.0193
7 Lyon               59 0.0059
8 Atalanta           55 0.0055</code></pre>
</div>
</div>
<p><em>Summary of final round match-ups with 10,000 simulations and</em> <span class="math inline">\(\lambda_1=0.06547312\)</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
# Groups:   home, away [16]
   home            away                n   prob
   &lt;chr&gt;           &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
 1 Paris S-G       Bayern Munich    4297 0.430 
 2 Paris S-G       Manchester City  2769 0.277 
 3 Paris S-G       Barcelona         716 0.0716
 4 RB Leipzig      Bayern Munich     548 0.0548
 5 Atlético Madrid Bayern Munich     429 0.0429
 6 RB Leipzig      Manchester City   319 0.0319
 7 Atlético Madrid Manchester City   279 0.0279
 8 Paris S-G       Lyon              168 0.0168
 9 Atalanta        Bayern Munich     154 0.0154
10 Atalanta        Manchester City    94 0.0094
11 RB Leipzig      Barcelona          84 0.0084
12 Atlético Madrid Barcelona          70 0.007 
13 Atalanta        Barcelona          38 0.0038
14 RB Leipzig      Lyon               21 0.0021
15 Atlético Madrid Lyon               11 0.0011
16 Atalanta        Lyon                3 0.0003</code></pre>
</div>
</div>
<section id="aside-lambda_1-home-field-advantage-impact" class="level3">
<h3 class="anchored" data-anchor-id="aside-lambda_1-home-field-advantage-impact">Aside: <span class="math inline">\(\lambda_1\)</span> (Home Field Advantage) Impact</h3>
<p>For a quick analysis into the impact of this <span class="math inline">\(\lambda_1\)</span> value, let’s compare the percentage that Bayern wins the tournament at varying values of <span class="math inline">\(\lambda_1\)</span>. We’ll utilize <code>0.065</code>, <code>0.2</code>, and <code>0.5</code> as a baseline value, medium-strength value, and strong home field advantage value respectively.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Report_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above graph shows that even with a substantial home field advantage, <code>0.5</code>, the observed effect is only a 1% increase in their win rate across 1,000 competitions.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>As seen throughout this final section, our results suggest that the real outcome of the 2019-2020 UEFA Champions League knockouts somewhat follow the expectation of our models. Whether with domestic strengths, or domestic strengths and home pitch advantage, we saw that the likeliest final was Bayern Munich-Paris S-G, which aligned with the real outcome, with PSG winning the bulk of the simulations, which didn’t. Surprisingly, this was true in our previous model, even though that saw some erroneous results inside of the top 5, which suggests that PSG should’ve been the favorite in this competition and may have been impacted by the changed format.</p>
<p>With that said, this model did perform better from a qualitiative and quantitative standpoint than our earlier models, suggesting that fitting only on group stage data, normalizing, and introducing the covariates did positively benefit the performance of the simulation.</p>
<div class="cell">
<div class="cell-output-display">
<div class="standings">
<div class="title">
<h2 class="anchored">2019-2020 UEFA Champions League Simulation</h2>
<h3 class="anchored">Chances of each team winning tournament based on 10,000 simulations with two-legs in knockout rounds.</h3>
</div>
<div class="reactable html-widget html-fill-item" id="htmlwidget-90dcbfb5b82e7934abec" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-90dcbfb5b82e7934abec">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"round_winner":["Paris S-G","Bayern Munich","Manchester City","Barcelona","RB Leipzig","Atlético Madrid","Lyon","Atalanta"],"prob":[0.4039,0.3125,0.1818,0.0457,0.0254,0.0193,0.0059,0.0055]},"columns":[{"id":"round_winner","name":"Team","type":"character","vAlign":"center","headerVAlign":"bottom","className":"cell team-name","headerClassName":"header","defaultSortDesc":false,"cell":[{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Paris S-G.png","src":"images/Paris S-G.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Paris S-G"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Bayern Munich.png","src":"images/Bayern Munich.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Bayern Munich"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Manchester City.png","src":"images/Manchester City.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Manchester City"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Barcelona.png","src":"images/Barcelona.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Barcelona"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/RB Leipzig.png","src":"images/RB Leipzig.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["RB Leipzig"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atlético Madrid.png","src":"images/Atlético Madrid.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atlético Madrid"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Lyon.png","src":"images/Lyon.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Lyon"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atalanta.png","src":"images/Atalanta.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atalanta"]}]}]}],"minWidth":250,"maxWidth":300,"headerStyle":{"fontWeight":700}},{"id":"prob","name":"Win Tournament","type":"numeric","vAlign":"center","headerVAlign":"bottom","className":"cell number ","headerClassName":"header","cell":[" 40%"," 31%"," 18%","  5%","  3%","  2%"," <1%"," <1%"],"maxWidth":150,"style":[{"color":"#111","background":"#AEDFAF"},{"color":"#111","background":"#BEE7B2"},{"color":"#111","background":"#D7F1BE"},{"color":"#111","background":"#F5FCDE"},{"color":"#111","background":"#F9FDEC"},{"color":"#111","background":"#FAFDF1"},{"color":"#aaa"},{"color":"#aaa"}]}],"defaultSortDesc":true,"defaultSorted":[{"id":"prob","desc":true}],"pagination":false,"borderless":true,"showSortIcon":false,"className":"standings-table","dataKey":"2141e54335fd00ba1e96425b6e1dbf25"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="standings">
<div class="title">
<h3 class="anchored">Chances of each team making tournament final based on 10,000 simulations with two-legs in knockout rounds.</h3>
</div>
<div class="reactable html-widget html-fill-item" id="htmlwidget-6bee9be1e00e6b4c9521" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6bee9be1e00e6b4c9521">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"team1":["Paris S-G","Paris S-G","Paris S-G","RB Leipzig","Atlético Madrid","RB Leipzig","Atlético Madrid","Paris S-G","Atalanta","Atalanta","RB Leipzig","Atlético Madrid","Atalanta","RB Leipzig","Atlético Madrid","Atalanta"],"team2":["Bayern Munich","Manchester City","Barcelona","Bayern Munich","Bayern Munich","Manchester City","Manchester City","Lyon","Bayern Munich","Manchester City","Barcelona","Barcelona","Barcelona","Lyon","Lyon","Lyon"],"prob":[0.4297,0.2769,0.0716,0.0548,0.0429,0.0319,0.0279,0.0168,0.0154,0.0094,0.0084,0.007,0.0038,0.0021,0.0011,0.0003]},"columns":[{"id":"team1","name":"Team 1","type":"character","vAlign":"center","headerVAlign":"bottom","className":"cell team-name","headerClassName":"header","defaultSortDesc":false,"cell":[{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Paris S-G.png","src":"images/Paris S-G.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Paris S-G"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Paris S-G.png","src":"images/Paris S-G.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Paris S-G"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Paris S-G.png","src":"images/Paris S-G.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Paris S-G"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/RB Leipzig.png","src":"images/RB Leipzig.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["RB Leipzig"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atlético Madrid.png","src":"images/Atlético Madrid.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atlético Madrid"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/RB Leipzig.png","src":"images/RB Leipzig.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["RB Leipzig"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atlético Madrid.png","src":"images/Atlético Madrid.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atlético Madrid"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Paris S-G.png","src":"images/Paris S-G.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Paris S-G"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atalanta.png","src":"images/Atalanta.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atalanta"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atalanta.png","src":"images/Atalanta.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atalanta"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/RB Leipzig.png","src":"images/RB Leipzig.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["RB Leipzig"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atlético Madrid.png","src":"images/Atlético Madrid.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atlético Madrid"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atalanta.png","src":"images/Atalanta.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atalanta"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/RB Leipzig.png","src":"images/RB Leipzig.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["RB Leipzig"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atlético Madrid.png","src":"images/Atlético Madrid.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atlético Madrid"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Atalanta.png","src":"images/Atalanta.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Atalanta"]}]}]}],"maxWidth":250,"headerStyle":{"fontWeight":700}},{"id":"team2","name":"Team 2","type":"character","vAlign":"center","headerVAlign":"bottom","className":"cell team-name","headerClassName":"header","defaultSortDesc":false,"cell":[{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Bayern Munich.png","src":"images/Bayern Munich.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Bayern Munich"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Manchester City.png","src":"images/Manchester City.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Manchester City"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Barcelona.png","src":"images/Barcelona.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Barcelona"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Bayern Munich.png","src":"images/Bayern Munich.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Bayern Munich"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Bayern Munich.png","src":"images/Bayern Munich.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Bayern Munich"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Manchester City.png","src":"images/Manchester City.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Manchester City"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Manchester City.png","src":"images/Manchester City.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Manchester City"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Lyon.png","src":"images/Lyon.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Lyon"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Bayern Munich.png","src":"images/Bayern Munich.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Bayern Munich"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Manchester City.png","src":"images/Manchester City.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Manchester City"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Barcelona.png","src":"images/Barcelona.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Barcelona"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Barcelona.png","src":"images/Barcelona.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Barcelona"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Barcelona.png","src":"images/Barcelona.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Barcelona"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Lyon.png","src":"images/Lyon.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Lyon"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Lyon.png","src":"images/Lyon.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Lyon"]}]}]},{"name":"div","attribs":{"className":"team"},"children":[{"name":"img","attribs":{"alt":"images/Lyon.png","src":"images/Lyon.png","className":"team-flag"},"children":[]},{"name":"div","attribs":{},"children":[{"name":"span","attribs":{"className":"team-name"},"children":["Lyon"]}]}]}],"maxWidth":250,"headerStyle":{"fontWeight":700}},{"id":"prob","name":"Made Final","type":"numeric","vAlign":"center","headerVAlign":"bottom","className":"cell number ","headerClassName":"header","cell":[" 43%"," 28%","  7%","  5%","  4%","  3%","  3%","  2%","  2%"," <1%"," <1%"," <1%"," <1%"," <1%"," <1%"," <1%"],"maxWidth":120,"style":[{"color":"#111","background":"#A9DDAE"},{"color":"#111","background":"#C4E9B3"},{"color":"#111","background":"#F0FAD0"},{"color":"#111","background":"#F3FBD7"},{"color":"#111","background":"#F6FCE0"},{"color":"#111","background":"#F8FCE8"},{"color":"#111","background":"#F9FDEA"},{"color":"#111","background":"#FBFDF2"},{"color":"#111","background":"#FBFEF3"},{"color":"#aaa"},{"color":"#aaa"},{"color":"#aaa"},{"color":"#aaa"},{"color":"#aaa"},{"color":"#aaa"},{"color":"#aaa"}]}],"defaultSortDesc":true,"defaultSorted":[{"id":"prob","desc":true}],"pagination":false,"borderless":true,"showSortIcon":false,"className":"standings-table","dataKey":"74aa02cffa5a5146e29be3cee626f180"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<section id="challenges-future-considerations" class="level3">
<h3 class="anchored" data-anchor-id="challenges-future-considerations">Challenges &amp; Future Considerations</h3>
<p>Throughout this project, we encountered several challenges that could see some improvement in the future. Namely, with fitting the Bradley-Terry models to the group stage, we saw significant deviations in team strengths, as well as missing values in model fitting due to the lack of team overlap in match-up results and a small sample size. Thus, our decisions to normalize the coefficients, as well as run several iterations of fitting to account for missing values may have skewed the team strengths somewhat. With that said, because our results aligned with those that played out in real life, there seems to be at least some merit to the process, including the use of domestic strengths as a covariate.</p>
<p>For future analyses of tournaments such as the UEFA Champions League, or other international competitions, it may be worthwhile to utilize simulations of not only the knockout stages, but also the group stages to observe a larger sample where deviations in results may be more evident. Further, a more detailed approach to breaking ties among aggregates could further differentiate our models from others, rather than utilizing the simplistic average goals-based Poisson model above.</p>

</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-poisson" class="csl-entry" role="listitem">
2010. <span>“Soccer: Is Scoring Goals a Predictable Poissonian Process?”</span> <a href="https://iopscience.iop.org/article/10.1209/0295-5075/89/38007/pdf">https://iopscience.iop.org/article/10.1209/0295-5075/89/38007/pdf</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://www.uefa.com/uefachampionsleague/match/2030150--paris-vs-bayern-munchen/" class="uri">https://www.uefa.com/uefachampionsleague/match/2030150--paris-vs-bayern-munchen/</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Members from the following domestic leagues took part in the 2019-20 UEFA Champions League group stage: <em>Austrian Football Bundesliga, Belgian Pro League, Croatian Football League, Czech First League, English Premier League, French Ligue 1, German Fusball Bundesliga, Greek Super League, Italian Serie A, Dutch Eredivise, Portugese Premeira Liga, Russian Premier League, Serbian SuperLiga, Spanish La Liga, Turkish Super Lig, Ukrainian Premier League</em><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Specific links and FBRef pages used can be found in the <em>GettingRawMatchupData.Rmd</em> notebook at <a href="https://github.com/masonlanger/STAT-479-Simulation">our GitHub repo</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p><a href="https://en.wikipedia.org/wiki/2018%E2%80%9319_Russian_Premier_League#League_table" class="uri">https://en.wikipedia.org/wiki/2018%E2%80%9319_Russian_Premier_League#League_table</a><a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>